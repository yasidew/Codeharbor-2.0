{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <title>{% block title %}Code Harbor Home{% endblock %}</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Favicon (Logo in Browser Tab) -->
    <link rel="icon" type="image/png" href="{% static 'images/code-harbor-logo.png' %}">

    <!-- Black Dashboard CSS -->
    <link href="{% static 'css/black-dashboard.min.css' %}" rel="stylesheet">
    <link href="{% static 'css/styles.css' %}" rel="stylesheet"> <!-- Custom Styles -->

    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Toastify CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <!-- Toastify JS -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
</head>
<body class="dark-mode">
<div class="wrapper">
    <!-- Sidebar (Dynamic based on Page) -->
{#    {% block sidebar %}#}
{#        <div class="sidebar" data-color="black">#}
{#            <div class="sidebar-wrapper">#}
{#                <div class="logo">#}
{#                    <a href="#" class="simple-text logo-mini">#}
{#                        <img src="{% static 'images/code-harbor-logo.png' %}" alt="Code Harbor Logo" width="30">#}
{#                    </a>#}
{#                    <a href="#" class="simple-text logo-normal">Code Harbor</a>#}
{#                </div>#}
{#                <ul class="nav" id="sidebarMenu">#}
{#                    <li><a href="#"><i class="bi bi-gear"></i>#}
{#                        <p>Settings</p></a></li>#}
{#                    <li><a href="#" onclick="logoutUser(); return false;"> <i class="bi bi-box-arrow-right"></i>#}
{#                        <p>Logout</p></a></li>#}
{#                </ul>#}
{#                {% if request.path == "http://127.0.0.1:8000/games/github-scraper/" %}#}
{#                <!-- Sidebar for Accessibility & Gamification -->#}
{#                <hr>#}
{#                <ul class="nav">#}
{#                    <li><a href="#"><i class="bi bi-trophy"></i>#}
{#                        <p>Leaderboard</p></a></li>#}
{#                </ul>#}
{#            {% endif %}#}
{##}
{#            </div>#}
{#        </div>#}
{#    {% endblock %}#}

{% block sidebar %}
    <div class="sidebar" data-color="black">
        <div class="sidebar-wrapper">
            <div class="logo">
                <a href="#" class="simple-text logo-mini">
                    <img src="{% static 'images/code-harbor-logo.png' %}" alt="Code Harbor Logo" width="30">
                </a>
                <a href="#" class="simple-text logo-normal">Code Harbor</a>
            </div>
            <ul class="nav" id="sidebarMenu">
                <li><a href="#"><i class="bi bi-gear"></i>
                    <p>Settings</p></a></li>
                <li><a href="#" onclick="logoutUser(); return false;"> <i class="bi bi-box-arrow-right"></i>
                    <p>Logout</p></a></li>
            </ul>

            {% if "/games/github-scraper/" in request.path %}
                <!-- Sidebar for Accessibility & Gamification -->
                <hr>
                <ul class="nav">
                    <li><a href="#"><i class="bi bi-trophy"></i>
                        <p>Leaderboard</p></a></li>
                </ul>
            {% endif %}
        </div>
    </div>
{% endblock %}


    <!-- Main Panel -->
    <div class="main-panel">
        <!-- Navbar -->
        <nav class="navbar navbar-expand-lg navbar-transparent navbar-absolute">
            <div class="container-fluid">
                <div class="navbar-wrapper">
                    <a class="navbar-brand" href="#">
                        <img src="{% static 'images/code-harbor-logo.png' %}" alt="Code Harbor Logo" width="40">
                    </a>
                </div>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation">
                    <span class="navbar-toggler-bar"></span>
                    <span class="navbar-toggler-bar"></span>
                    <span class="navbar-toggler-bar"></span>
                </button>
                <div class="collapse navbar-collapse justify-content-end" id="navigation">
                    <ul class="navbar-nav">
                        <li class="nav-item"><a class="nav-link" href="http://127.0.0.1:8000/profile/<str:username>/"><i
                                class="bi bi-person-circle"></i>
                            Profile</a></li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <div class="content">
            <div class="container-fluid">
                {% block content %}
                {% endblock %}
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <div class="container-fluid">
                <nav class="float-left">
                    <ul>
                        <li><a href="#">Code Harbor</a></li>
                    </ul>
                </nav>
                <div class="copyright text-right">
                    &copy;
                    <script>document.write(new Date().getFullYear())</script>
                    , Code Harbor.
                </div>
            </div>
        </footer>
    </div>
</div>

<!-- Core JS Files -->
<script src="{% static 'js/black-dashboard.min.js' %}"></script>
<script>

    /////////////////// wasana ///////////////////////

    // Get username from localStorage
    const username = localStorage.getItem('username');

    // Update profile link with the username if it exists
    if (username) {
        const profileLink = document.querySelector('.nav-item a[href^="http://127.0.0.1:8000/profile/"]');
        if (profileLink) {
            profileLink.href = `http://127.0.0.1:8000/profile/${username}/`;
        }
    }



    document.addEventListener("DOMContentLoaded", function () {
        const sidebarMenu = document.getElementById("sidebarMenu");
        const isLoggedIn = localStorage.getItem("isLoggedIn");

        if (isLoggedIn === "true") {
            sidebarMenu.innerHTML = `
                <li><a href="/dashboard"><i class="bi bi-house"></i>
                    <p>Dashboard</p></a></li>
                <li><a href="/profile"><i class="bi bi-person"></i>
                    <p>Profile</p></a></li>
                <li><a href="/games/github-scraper/"><i class="bi bi-controller"></i>
                    <p>Games</p></a></li>
                <li><a href="#" onclick="logoutUser(); return false;"><i class="bi bi-box-arrow-right"></i>
                    <p>Logout</p></a></li>
            `;
        }
    });


    function logoutUser() {
        localStorage.removeItem('accessToken');
        localStorage.removeItem('refreshToken');
        alert("You have logged out.");
        window.location.href = '/login'; // Redirect to login page
    }

    // Logout functionality
    document.getElementById('logoutButton').addEventListener('click', logoutUser);

    document.getElementById('logoutLink').addEventListener('click', logoutUser);


    function showToast(message, type = "success") {
        let backgroundColor;

        switch (type) {
            case "success":
                backgroundColor = "linear-gradient(to right, #4CAF50, #2E7D32)"; // Green ✅
                break;
            case "error":
                backgroundColor = "linear-gradient(to right, #FF5733, #C70039)"; // Red ❌
                break;
            case "warning":
                backgroundColor = "linear-gradient(to right, #FFA500, #FF8C00)"; // Orange ⚠️
                break;
            default:
                backgroundColor = "linear-gradient(to right, #333, #555)"; // Default Grey
        }

        Toastify({
            text: message,
            duration: 3000,
            gravity: "top",  // "top" or "bottom"
            position: "right", // "left", "center", or "right"
            backgroundColor: backgroundColor,
            close: true,
        }).showToast();
    }


    ///////////////////////// wasana ///////////////////////



</script>
</body>
</html>


