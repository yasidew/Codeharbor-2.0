{#{% load static %}#}
{#<!DOCTYPE html>#}
{#<html lang="en">#}
{#<head>#}
{#    <meta charset="UTF-8">#}
{#    <meta name="viewport" content="width=device-width, initial-scale=1.0">#}
{#    <title>Code Harbor - Calculate Code Complexity</title>#}
{#    <!-- Bootstrap CSS -->#}
{#    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">#}
{#    <!-- Custom CSS -->#}
{#    <link href="{% static 'style.css' %}" rel="stylesheet">#}
{#    <!-- CodeMirror CSS -->#}
{#    <link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.9/codemirror.min.css" rel="stylesheet">#}
{#    <link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.9/theme/material-darker.min.css"#}
{#          rel="stylesheet">#}
{#</head>#}
{#<body class="light-mode">#}
{#<!-- Header -->#}
{#<header id="header" class="bg-primary text-white text-center py-3">#}
{#    <div class="d-flex align-items-center justify-content-between container">#}
{#        <div class="d-flex align-items-center">#}
{#            <img src="{% static 'images/code-harbor-logo.png' %}" alt="Code Harbor Logo" class="logo-styling">#}
{#        </div>#}
{#        <h1 class="mb-0 text-center flex-grow-1">Code Harbor</h1>#}
{#        <div class="toggle-container">#}
{#            <span class="text-white me-2">Light</span>#}
{#            <div id="toggle" class="toggle">#}
{#                <div class="circle"></div>#}
{#            </div>#}
{#            <span class="text-white ms-2">Dark</span>#}
{#        </div>#}
{#    </div>#}
{#    <p>Your tool for code analysis, defect detection, and formatting</p>#}
{#</header>#}
{##}
{#<!-- Main Content -->#}
{#<main class="container my-5">#}
{#    <div class="bg-white p-4 rounded shadow-sm">#}
{#        <h2 class="text-center mb-4">Calculate Code Complexity - Java</h2>#}
{#        <p class="text-center text-muted mb-4">Upload your Java files to analyze code complexity. Supports multiple file#}
{#            uploads.</p>#}
{#        <form method="POST" action="" enctype="multipart/form-data" class="mx-auto" style="max-width: 400px;">#}
{#            {% csrf_token %}#}
{#            <div class="mb-3">#}
{#                <label for="files" class="form-label">Upload Your Java Files:</label>#}
{#                <input type="file" name="files" id="files" class="form-control" accept=".java" multiple>#}
{#            </div>#}
{#            <button type="submit" class="btn btn-primary w-100" onclick="showLoading()">Calculate Complexity</button>#}
{#        </form>#}
{#    </div>#}
{#</main>#}
{##}
{#<div id="loading-spinner"#}
{#     style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);">#}
{#    <div class="spinner-border text-primary" role="status">#}
{#        <span class="visually-hidden">Loading...</span>#}
{#    </div>#}
{#</div>#}
{##}
{#<!-- Footer -->#}
{#<footer class="bg-dark text-white text-center py-3 mt-auto">#}
{#    <p>&copy; 2024 Code Harbor. All rights reserved.</p>#}
{#</footer>#}
{##}
{#<!-- JavaScript -->#}
{#<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.9/codemirror.min.js"></script>#}
{#<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.9/mode/javascript/javascript.min.js"></script>#}
{#<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.9/addon/edit/matchbrackets.min.js"></script>#}
{#<script>#}
{#    // JavaScript for the toggle button#}
{#    const toggle = document.getElementById('toggle');#}
{#    const body = document.body;#}
{##}
{#    toggle.addEventListener('click', () => {#}
{#        body.classList.toggle('dark-mode');#}
{#        toggle.classList.toggle('dark');#}
{#    });#}
{##}
{#    function showLoading() {#}
{#        document.getElementById('loading-spinner').style.display = 'block';#}
{#    }#}
{##}
{#    function hideLoading() {#}
{#        document.getElementById('loading-spinner').style.display = 'none';#}
{#    }#}
{##}
{#    // Ensure loading stops when the page loads completely#}
{#    window.onload = function () {#}
{#        hideLoading();#}
{#    };#}
{#</script>#}
{#</body>#}
{#</html>#}

{% extends 'base.html' %}
{% load static %}

{% block title %}Code Complexity Analysis - Java{% endblock %}

{% block content %}
    <style>
        /* Page Background */
        body {
            background-color: #0d1117;
            color: #c9d1d9;
        }

        /* Centered Container */
        .container-custom {
            max-width: 800px;
            margin: auto;
            background-color: #161b22;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.5);
            text-align: center;
        }

        .container-custom1 {
            max-width: 1100px;
            margin: auto;
            background-color: #161b22;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.5);
            text-align: center;
        }

        /* Collapsible Table */
        .table-container {
            width: 1000px;
            background-color: #161b22;
            border-radius: 12px;
            padding: 10px;
            margin-top: 20px;
        }

        .table-header {
            background-color: #21262d;
            padding: 10px;
            cursor: pointer;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-header h5 {
            margin: 0;
            color: #58a6ff;
        }

        /* Hide initially */
        .table-content {
            width: 1000px;
            display: none;
            padding: 10px;
            background-color: #0d1117;
            border-radius: 8px;
            margin-top: 5px;
        }

        .table th, .table td {
            border: 1px solid #30363d;
            padding: 10px;
            text-align: center;
        }

        .table th {
            background-color: #21262d;
            color: #58a6ff;
        }

        .table-hover tbody tr:hover {
            background-color: #30363d;
        }
    </style>

    <div class="container my-5">
        <div class="container-custom">
            <h2>Calculate Code Complexity - Java</h2>
            <p class="text-muted">Upload your Java files to analyze code complexity. Supports multiple file uploads.</p>

            <form method="POST" action="" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="mb-3">
                    <label for="files" class="form-label">Upload Your Java Files:</label>
                    <input type="file" name="files" id="files" class="form-control" accept=".java" multiple>
                </div>
                <button type="submit" class="btn btn-primary w-100" onclick="showLoading()">Calculate Complexity
                </button>
            </form>
        </div>

        <!-- Display Analysis Results -->
        {% if complexities %}
            <div class="container-custom1 mt-4">
                <h3>Analysis Results</h3>
                {% for file in complexities %}
                    <div class="table-container">
                        <!-- Clickable Header -->
                        <div class="table-header" data-id="{{ file.filename|slugify }}">
                            <h5>{{ file.filename }}</h5>
                            <span><strong>Total WCC:</strong> {{ file.total_wcc }}</span>
                        </div>

                        <!-- Collapsible Content -->
                        <div class="table-content" id="table-{{ file.filename|slugify }}">
                            <table class="table table-hover">
                                <thead>
                                <tr>
                                    <th>Method</th>
                                    <th>Size</th>
                                    <th>Control</th>
                                    <th>Nesting</th>
                                    <th>Inheritance</th>
                                    <th>Compound</th>
                                    <th>Try-Catch</th>
                                    <th>Thread</th>
                                    <th>CBO</th>
                                    <th>Complexity</th>
                                    <th>Category</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for method in file.method_complexities %}
                                    <tr>
                                        <td>{{ method.method_name }}</td>
                                        <td>{{ method.size }}</td>
                                        <td>{{ method.control_structure_complexity }}</td>
                                        <td>{{ method.nesting_weight }}</td>
                                        <td>{{ method.inheritance_weight }}</td>
                                        <td>{{ method.compound_condition_weight }}</td>
                                        <td>{{ method.try_catch_weight }}</td>
                                        <td>{{ method.thread_weight }}</td>
                                        <td>{{ method.cbo_weight }}</td>
                                        <td>{{ method.total_complexity }}</td>
                                        <td>
                                            <span class="badge {% if method.category == 'High' %}bg-danger{% elif method.category == 'Medium' %}bg-warning{% else %}bg-success{% endif %}">
                                                {{ method.category }}
                                            </span>
                                        </td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    </div>

    <!-- JavaScript Code Placed at the Bottom -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            function toggleTable(event) {
                let header = event.target.closest(".table-header");
                if (!header) return; // Exit if not a header click
                let tableId = header.getAttribute("data-id");
                let content = document.getElementById("table-" + tableId);
                if (content) {
                    content.style.display = content.style.display === "none" ? "block" : "none";
                }
            }

            // Attach event listener to all headers
            document.querySelectorAll(".table-header").forEach(header => {
                header.addEventListener("click", toggleTable);
            });
        });

        function showLoading() {
            document.getElementById('loading-spinner').style.display = 'flex';
        }

        function hideLoading() {
            document.getElementById('loading-spinner').style.display = 'none';
        }

        window.onload = function () {
            hideLoading();
        };
    </script>
{% endblock %}