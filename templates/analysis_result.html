{% extends 'base.html' %}
{% load static %}

{% block title %}Statistical Analysis Results{% endblock %}

{% block content %}
    <style>
        /* Page Styling */
        .container-custom {
            max-width: 1100px;
            margin: auto;
            background-color: #161b22;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.5);
            text-align: center;
        }

        /* Headings */
        h1, h2 {
            color: #58a6ff;
            font-weight: bold;
        }

        /* Tables */
        .table {
            border-radius: 8px;
            overflow: hidden;
        }

        .table thead {
            background-color: #21262d;
            color: #c9d1d9;
        }

        .table tbody tr {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .table tbody tr:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        /* Image Styling */
        .analysis-img {
            max-width: 100%;
            border-radius: 10px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.3);
        }

        .custom-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: green;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }

        .show-toast {
            opacity: 1;
        }

    </style>

    <div class="container mt-5">
        <h1 class="text-center">Statistical Analysis Results</h1>

        <p>This page presents the statistical analysis of Weighted Code Complexity (WCC) and its relationship with
            various software quality metrics such as Complexity, Maintainability, and Readability. The analysis includes
            correlation coefficients, scatter plots, clustering, and boxplots.</p>

        <!-- Correlation Analysis -->
        <section class="my-5">
            <h2>Correlation Analysis</h2>

            <div class="table-responsive">
                <table class="table table-bordered text-white">
                    <thead>
                    <tr>
                        <th>Metric</th>
                        <th>Pearson Correlation</th>
                        <th>Pearson p-value</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for column, result in pearson_results.items %}
                        <tr>
                            <td>{{ column }}</td>
                            <td>{{ result.correlation }}</td>
                            <td>{{ result.p_value }}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>

            <div class="table-responsive mt-4">
                <table class="table table-bordered text-white">
                    <thead>
                    <tr>
                        <th>Metric</th>
                        <th>Spearman Correlation</th>
                        <th>Spearman p-value</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for column, result in spearman_results.items %}
                        <tr>
                            <td>{{ column }}</td>
                            <td>{{ result.correlation }}</td>
                            <td>{{ result.p_value }}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>

            <p>These tables display the Pearson Correlation and Spearman Correlation between WCC and other software
                quality metrics.</p>
            <h4>üìå Pearson Correlation Table</h4>
            <ul>
                <li>Pearson Correlation measures the linear relationship between WCC and the given metrics.</li>
                <li>Complexity (0.7209) ‚Üí WCC increases as Complexity increases (positive correlation).</li>
                <li>Maintainability (-0.5285) ‚Üí WCC increases as Maintainability decreases (negative correlation).</li>
                <li>Readability (-0.4532) ‚Üí WCC increases as Readability decreases (negative correlation).</li>
            </ul>
            <h4>üìå Spearman Correlation Table</h4>
            <ul>
                <li>Spearman Correlation is a rank-based correlation that measures relationships using a monotonic
                    function.
                </li>
                <li>Complexity (0.7689) has a strong positive monotonic correlation with WCC.</li>
                <li>Maintainability (-0.5261) and Readability (-0.5670) show negative monotonic relationships.</li>
            </ul>
        </section>

        <!-- Scatter Plots -->
        <section class="my-5">
            <h2>Scatter Plots</h2>
            <h4>Scatter plots visualize the relationship between WCC and various software quality metrics.</h4>
            {% for column, plot_path in scatter_plots.items %}
                <div class="mb-4">
                    <h3 class="text-muted" style="color: blueviolet">{{ column }} vs WCC</h3>
                    <img src="{{ MEDIA_URL }}/media/scatter_{{ column }}.png" alt="Scatter plot for {{ column }}"
                         class="analysis-img">
                </div>
            {% endfor %}
            <h4>üìå Complexity vs WCC (First Scatter Plot)</h4>
            <ul>
                <li>Shows how Complexity changes as WCC increases.
                </li>
                <li>Red trendline indicates a positive correlation (higher WCC tends to have higher Complexity).</li>
                <li>The distribution of points shows a strong relationship, confirming the correlation table results.
                </li>
            </ul>

            <h4>üìå Maintainability vs WCC (Second Scatter Plot)</h4>
            <ul>
                <li>Shows how Maintainability changes as WCC increases.
                </li>
                <li>Red trendline shows a negative correlation (higher WCC tends to have lower Maintainability).</li>
                <li>This means complex code is generally harder to maintain.</li>
            </ul>
            <h4>üìå Readability vs WCC (Third Scatter Plot)</h4>
            <ul>
                <li>Shows how Readability changes as WCC increases.
                </li>
                <li>Red trendline shows a negative correlation (higher WCC tends to have lower Readability).</li>
                <li>Complex code is harder to read and understand.</li>
            </ul>
        </section>

        <!-- Cluster Centers -->
        <section class="my-5">
            <h2>Cluster Centers (Thresholds)</h2>
            <p>Clustering was performed to determine two complexity levels: **Low Complexity** and **High Complexity**.
            </p>
            <h4 style="color: green"><strong>Low Complexity:</strong> {{ low_center }}</h4>
            <h4 style="color: red"><strong>High Complexity:</strong> {{ high_center }}</h4>
            <p>These values help define complexity levels and categorize methods into <b>Low, Medium, and High
                Complexity.</b></p>
        </section>

        <section class="my-5">
            <h2>WCC Clustering and Thresholds Graph </h2>
            <ul>
                <li>This scatter plot clusters methods based on their WCC values.</li>
                <li>Orange and blue dots represent two clusters (Low & High complexity).</li>
                <li>The dotted lines represent threshold values, visually separating low and high complexity
                    components.
                </li>
            </ul>
            <img src="{{ MEDIA_URL }}/media/wcc_clustering.png" alt="Boxplot of WCC by Complexity Level"
                 class="analysis-img">
        </section>

        <!-- Boxplot -->
        <section class="my-5">
            <h2>Boxplot of WCC by Complexity Level</h2>
            <ul>
                <li>A boxplot represents the distribution of WCC values for high and low complexity groups.</li>
                <li>The High Complexity group has higher WCC values with a larger spread.</li>
                <li>The Low Complexity group has lower WCC values with a more compact distribution.</li>
            </ul>
            <img src="{{ MEDIA_URL }}/media/boxplot_with_thresholds.png" alt="Boxplot of WCC by Complexity Level"
                 class="analysis-img">
        </section>
    </div>

    <div id="customToast" class="custom-toast"></div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            console.log("üî• DOM fully loaded. Checking for content...");

            // Check if complexities exist in the DOM
            const complexitiesContainer = document.querySelector(".container");
            if (complexitiesContainer) {
                console.log("‚úÖ Complexity details found!");

                // Call the toast function when all details are loaded
                setTimeout(() => {
                    console.log("‚è≥ Calling showCustomToast()...");
                    showCustomToast("‚úÖ Statistical Analysis Successfully!");
                }, 1000); // Add a small delay to simulate loading
            } else {
                console.warn("‚ö†Ô∏è No complexity details found. Skipping toast.");
            }
        });

        function showCustomToast(message) {
            console.log("üî• showCustomToast() function called!");

            const toast = document.getElementById('customToast');
            if (!toast) {
                console.error("‚ùå ERROR: Toast element not found!");
                return;
            }

            console.log("‚úÖ Toast element found!");

            // Ensure it's visible before applying animation
            toast.style.display = 'block';
            setTimeout(() => {
                toast.textContent = message;
                toast.classList.add('show-toast');
                console.log("üéâ Toast is now visible!");
            }, 10); // Small delay to trigger animation

            // Auto-hide after 3 seconds
            setTimeout(() => {
                toast.classList.remove('show-toast');
                console.log("‚åõ Hiding toast...");
                setTimeout(() => {
                    toast.style.display = 'none';
                    console.log("‚ùå Toast is now hidden.");
                }, 500); // Matches the CSS transition
            }, 3000);
        }
    </script>
{% endblock %}