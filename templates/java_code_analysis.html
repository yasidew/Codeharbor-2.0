{% extends 'base.html' %}

{% block content %}
    <h1 class="text-center mb-4">Java Code Analyzer</h1>

    {% if error %}
        <div class="alert alert-danger text-center">
            <i class="fas fa-exclamation-triangle"></i> {{ error }}
        </div>
    {% endif %}
    <!-- Include Toast Messages from code_analysis directory -->
    {% include 'code_analysis/toast_messages.html' %}

    <div id="loading-spinner" style="
        display: none;
        position: fixed;
        top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0, 0, 0, 0.75);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 20px;
        z-index: 1000;
        flex-direction: column;
    ">
        <div class="dots-loader">
            <span class="red"></span>
            <span class="yellow"></span>
            <span class="green"></span>
            <span class="blue"></span>
        </div>
        <p>Analyzing Code... Please Wait</p>
    </div>

    <nav class="mb-4">
        <ul class="nav justify-content-center">
            {#            <li class="nav-item">#}
            {#                <a class="nav-link btn btn-outline-primary" href="{% url 'java_code_analysis' %}">Java Code Analyzer</a>#}
            {#            </li>#}
            <li class="nav-item">
                <a class="nav-link btn btn-outline-primary" href="{% url 'analyze_code' %}">Python Code Analyzer</a>
            </li>
            {#            <li class="nav-item">#}
            {#                <a class="nav-link btn btn-outline-primary" href="{% url 'js_code_analyser' %}">JavaScript Analyzer</a>#}
            {#            </li>#}
        </ul>
    </nav>

    <div class="container">
        <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            {#            <div class="mb-3">#}
            {#                <label for="fileInput" class="form-label">Upload File(s):</label>#}
            {#                <input type="file" name="files" id="fileInput" class="form-control mb-3" multiple>#}
            {#            </div>#}
            <div class="mb-3">
                <label for="fileInput" class="form-label fw-bold">
                    <i class="fas fa-file-upload"></i> Upload File(s):
                </label>

                <div class="upload-container text-center">
                    <label for="fileInput" class="upload-box d-flex align-items-center justify-content-center">
                        <div class="text-center">
                            <i class="fas fa-cloud-upload-alt fa-3x text-primary"></i>
                            <p class="mt-2">Click or Drag & Drop files here</p>
                        </div>
                        <input type="file" name="files" id="fileInput" class="form-control d-none" multiple>
                    </label>
                    <div id="fileNameDisplay" class="mt-2 text-muted"></div>
                </div>
            </div>

            <!-- 🌟 Company Guideline Upload - Clean & Professional -->
            <div class="card shadow-sm mb-4 bg-gradient bg-dark text-white border-0 rounded">
                <div class="card-header bg-primary text-white fw-bold rounded-top d-flex align-items-center">
                    <i class="fas fa-shield-alt me-2"></i> Company Coding Guidelines <small class="ms-2 text-light">(Optional)</small>
                </div>
                <div class="card-body">
                    <p class="mb-2 text-white-50"><i class="fas fa-info-circle text-warning me-1"></i> Upload a guideline file to tailor suggestions to your company’s standards.</p>
                    <input type="file" name="guideline_file" id="guidelineFile" class="form-control bg-dark text-white border-secondary">
                </div>
            </div>


            <div class="d-flex flex-wrap align-items-end gap-3 mb-4">
                <!-- GitHub Button (unchanged width) -->
                <button id="githubBtn" class="btn btn-lg btn-github">
                    <i class="fab fa-github"></i> Import from GitHub
                </button>

                <!-- GitHub File Dropdown (adjusted to fit next to button) -->
                <div style="flex: 1;">
                    <label class="form-label fw-bold mb-1">
                        <i class="fas fa-file-code"></i> Select File Imported from GitHub to Analyze:
                    </label>
                    <div class="input-group">
                        <select id="fileSelector" class="form-select">
                            <option selected disabled>Select a file</option>
                        </select>
                        <span class="input-group-text bg-primary text-white">
                            <i class="fas fa-folder-open"></i>
                        </span>
                    </div>
                </div>
            </div>



            <!-- Button to Open Modal -->
{#            <div class="text-center mb-3">#}
{#                <button id="githubBtn" class="btn btn-lg btn-github">#}
{#                    <i class="fab fa-github"></i> Import from GitHub#}
{#                </button>#}
{#            </div>#}
{##}
{#            #}
{#            <div class="mb-3">#}
{#                <label class="form-label fw-bold">#}
{#                    <i class="fas fa-file-code"></i> Select File Imported from GitHub to Analyze:#}
{#                </label>#}
{##}
{#                <div class="input-group">#}
{#                    <select id="fileSelector" class="form-select custom-dropdown">#}
{#                        <option selected disabled>Select a file</option>#}
{#                    </select>#}
{#                    <span class="input-group-text bg-primary text-white">#}
{#                        <i class="fas fa-folder-open"></i>#}
{#                    </span>#}
{#                </div>#}

                <!-- Monaco Editor Container -->
                <div id="monaco-container" class="mt-3 rounded shadow-sm"></div>
                <textarea id="codeEditor" name="code" style="display: none;">{{ code }}</textarea>
                </div>

            <!-- Initialize Monaco Editor -->
            <script>
                require.config({ paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.0/min/vs' }});
                require(["vs/editor/editor.main"], function () {
                    window.editor = monaco.editor.create(document.getElementById("monaco-container"), {
                        value: "", // Start empty
                        language: "java",
                        theme: "vs-dark"
                    });
                });
            </script>


            <div class="text-center mt-3">
                <button type="submit" class="btn btn-lg btn-primary px-4 py-2 shadow-sm rounded-pill" style="background: linear-gradient(135deg, #007bff, #0056b3); border: none; font-weight: bold; transition: 0.3s;">
                    <i class="fas fa-search"></i> Analyze Code
                </button>
            </div>

        </form>

        <!-- GitHub Repository Modal (Initially Hidden) -->
        <div id="githubModal" class="github-modal">
            <div class="github-modal-content">
                <h4 class="text-center"><i class="fab fa-github"></i> Import from GitHub</h4>
                <p class="text-center">Enter the GitHub repository URL to analyze.</p>

                <input type="text" id="githubRepoUrl" class="form-control"
                       placeholder="Enter GitHub Repo URL (e.g., https://github.com/user/repo)">

                <div class="text-center mt-3">
                    <button id="analyzeGithubBtn" class="btn">Fetch</button>
                    <button id="closeGithubBtn" class="btn">Close</button>
                </div>
            </div>
        </div>

        <!-- Hidden Form to Submit GitHub URL -->
        <form id="githubForm" method="POST" action="{% url 'java_code_analysis' %}">
            {% csrf_token %}
            <input type="hidden" name="github_url" id="githubRepoInput">
        </form>



        <div id="analysis-results" class="mt-4">
            {% if suggestions %}
                <h2 class="text-center mb-4">Analysis Results:</h2>
                <div class="recommendation-container scrollable-container">
                    {% for suggestion in suggestions %}
                        {#                        <div class="code-block">#}
                        {#                            <strong>📂 File Name: {{ suggestion.file_name }}</strong> <br> <!-- ✅ Show File Name -->#}
                        {#                            <strong>🔹 Code With Issue:</strong>#}
                        {#                            <pre>{{ suggestion.code }}</pre>#}
                        {#                        </div>#}
                        {#                        <div class="suggestion-block">#}
                        {#                            <strong>💡 Suggestion:</strong>#}
                        {#                            <pre>{{ suggestion.suggestion | safe }}</pre>#}
                        {#                        </div>#}
                        <div class="card mb-4 shadow-sm border-0 rounded-lg suggestion-card" style="background-color: #1e1e2f; color: #ffffff;">
                            <div class="card-header d-flex justify-content-between align-items-center bg-transparent border-bottom border-secondary">
                                <h5 class="mb-0 text-warning fw-bold">
                                    <i class="fas fa-bug"></i> Issue in <code class="text-light">{{ suggestion.file_name }}</code>
                                </h5>
                                <span class="badge bg-danger" data-bs-toggle="tooltip" data-bs-placement="top"
                                      title="{% include 'code_analysis/severity_tooltip.html' with level=suggestion.severity %}">
                            {{ suggestion.severity }}
                        </span>
                            </div>

                            <div class="card-body">
                                <div class="mb-3">
                                    <h6 class="text-info"><i class="fas fa-code"></i> Problematic Code (Line {{ suggestion.line }})</h6>
                                    <pre class="bg-dark p-3 rounded text-white" style="font-size: 0.9rem;">{{ suggestion.code }}</pre>
                                </div>

                                <div class="mb-3">
                                    <h6 class="text-success"><i class="fas fa-lightbulb"></i> AI-Powered Suggestion</h6>
                                    <div class="bg-secondary p-3 rounded suggestion-content" style="white-space: pre-wrap;">
                                        {{ suggestion.suggestion | safe }}
                                    </div>
                                </div>

                                <div class="d-flex justify-content-between align-items-center mt-3">
                            <span class="badge bg-primary px-3 py-2" data-bs-toggle="tooltip" data-bs-placement="top"
                                  title="{% include 'code_analysis/category_tooltip.html' with name=suggestion.category %}">
                                {{ suggestion.category }}
                            </span>
                                    <i class="fas fa-robot text-muted"> AI Analyzed</i>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="text-center">No recommendations available. Paste or upload code to analyze.</p>
            {% endif %}
        </div>


        {#        <div id="analysis-results" class="mt-4">#}
        {#            {% if suggestions %}#}
        {#                <h2 class="text-center mb-4">Analysis Results:</h2>#}
        {#                <div class="recommendation-container scrollable-container">#}
        {#                    {% for suggestion in suggestions %}#}
        {#                        <div class="code-block">#}
        {#                            <strong>Code With Issue:</strong>#}
        {#                            <pre>{{ suggestion.code }}</pre>#}
        {#                        </div>#}
        {#                        <div class="suggestion-block">#}
        {#                            <strong>Suggestion:</strong>#}
        {#                            <pre>{{ suggestion.suggestion | safe}}</pre>#}
        {#                        </div>#}
        {#                    {% endfor %}#}
        {#                </div>#}
        {#            {% else %}#}
        {#                <p class="text-center">No recommendations available. Paste or upload code to analyze.</p>#}
        {#            {% endif %}#}
        {#        </div>#}

        <!-- Summary Report Section -->
        <div class="container mt-4">
            <div class="row">
                <div class="col-md-6">
                    <div class="summary-panel p-3 shadow-sm rounded">
                        <h3 class="text-center">Code Analysis Summary Report</h3><br>
                        <p><strong style="color: white;">Total Code Segments Analyzed:</strong> {{ summary.total_snippets }}</p>
                        <p><strong style="color: white;">Total Suggestions:</strong> {{ summary.total_suggestions }}</p>
                        <p><strong style="color: white;">Total Code Lines Processed:</strong> {{ summary.total_lines }}</p>

                        <!-- Code Complexity Metrics Section -->
                        {% include 'code_analysis/java_complexity_metrics.html' %}
                        <hr>
                        <div class="alert alert-info shadow-sm" role="alert" style="font-size: 0.95rem;">
                            <i class="fas fa-info-circle"></i>
                            <strong> What is Weighted Code Complexity (WCC)?</strong><br>
                            WCC is a composite score reflecting the complexity of your code by considering multiple factors like control structures, nesting levels, inheritance, exception handling, threading, and coupling.
                            <br><strong>Why it matters:</strong> Higher WCC often indicates hard-to-maintain or error-prone code.
                        </div>

                        <div class="alert alert-secondary shadow-sm" role="alert" style="font-size: 0.9rem;">
                            <i class="fas fa-lightbulb text-warning"></i>
                            <strong>How to use Method Complexity Breakdown:</strong>
                            This table shows how each method contributes to overall complexity. Keep an eye on methods with <span style="color: #721c24;">High</span> complexity – they may require refactoring or simplification for better maintainability.
                        </div>

                        {% if summary.total_wcc %}
                            <div class="text-center mt-4">
                                <h5 class="text-warning">
                                    🧮 Total Weighted Code Complexity (WCC): {{ summary.total_wcc }}
                                </h5>
                            </div>
                        {% endif %}

                        {% if summary.method_complexities %}
                            <div class="container mt-5">
                                <h3 class="text-center text-info mb-4">📊 Method Complexity Breakdown</h3>
                                <table class="table table-bordered table-hover table-dark text-center shadow">
                                    <thead class="thead-light">
                                    <tr>
                                        <th>Method Name</th>
                                        <th>S</th>
                                        <th>W<sub>c</sub></th>
                                        <th>W<sub>n</sub></th>
                                        <th>W<sub>i</sub></th>
                                        <th>W<sub>cc</sub></th>
                                        <th>W<sub>tc</sub></th>
                                        <th>W<sub>th</sub></th>
                                        <th>W<sub>cbo</sub></th>
                                        <th>Total</th>
                                        <th>Category</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    {% for metrics in summary.method_complexities %}
                                        <tr
                                                {% if metrics.category == 'High' %}style="background-color: #f8d7da; color: #721c24;"{% endif %}
                                                {% if metrics.category == 'Medium' %}style="background-color: #fff3cd; color: #856404;"{% endif %}
                                                {% if metrics.category == 'Low' %}style="background-color: #d4edda; color: #155724;"{% endif %}
                                        >
                                            <td>{{ metrics.method_name }}</td>
                                            <td>{{ metrics.size }}</td>
                                            <td>{{ metrics.control_structure_complexity }}</td>
                                            <td>{{ metrics.nesting_level }}</td>
                                            <td>{{ metrics.inheritance_level }}</td>
                                            <td>{{ metrics.compound_condition_weight }}</td>
                                            <td>{{ metrics.try_catch_weight }}</td>
                                            <td>{{ metrics.thread_weight }}</td>
                                            <td>{{ metrics.cbo_weights }}</td>
                                            <td>{{ metrics.total_complexity }}</td>
                                            <td>
                                                {% if metrics.category == 'High' %}
                                                    <span class="badge bg-danger px-3 py-2">High</span>
                                                {% elif metrics.category == 'Medium' %}
                                                    <span class="badge bg-warning text-dark px-3 py-2">Medium</span>
                                                {% else %}
                                                    <span class="badge bg-success px-3 py-2">Low</span>
                                                {% endif %}
                                            </td>

                                        </tr>
                                    {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% endif %}



                        <hr>
                        {#                        <h4>Categories</h4>#}
                        {#                      #}
                        {#                        <div class="category-container">#}
                        {#                            <ul class="list-group">#}
                        {#                                {% for category, count in summary.categories.items %}#}
                        {#                                    <li class="list-group-item d-flex justify-content-between align-items-center category-toggle"#}
                        {#                                        data-category="{{ category }}">#}
                        {#                                        {{ category }}#}
                        {#                                        <span class="badge bg-primary rounded-pill">{{ count }}</span>#}
                        {#                                    </li>#}
                        {#                                    <div class="category-details" id="{{ category|slugify }}-details" style="display: none;">#}
                        {#                                        {% for suggestion in suggestions %}#}
                        {#                                            {% if suggestion.category == category %}#}
                        {#                                                <div class="code-block">#}
                        {#                                                    <strong>Code With Issue (Line {{ suggestion.line }}):</strong>#}
                        {#                                                    <pre>{{ suggestion.code }}</pre>#}
                        {#                                                </div>#}
                        {#                                                <div class="suggestion-block">#}
                        {#                                                    <strong>Suggestion:</strong>#}
                        {#                                                    <pre>{{ suggestion.suggestion | safe }}</pre>#}
                        {#                                                </div>#}
                        {#                                            {% endif %}#}
                        {#                                        {% endfor %}#}
                        {#                                    </div>#}
                        {#                                {% endfor %}#}
                        {#                            </ul>#}
                        {#                        </div>#}
                        <div class="category-section mt-4">
                            <h4 class="text-center text-light fw-bold mb-4">
                                🚀 Category-Wise Insights
                            </h4>

                            <div class="accordion accordion-flush" id="categoryAccordion">
                                {% for category, count in summary.categories.items %}
                                    <div class="accordion-item bg-dark border-secondary rounded mb-3 shadow-sm">
                                        <h2 class="accordion-header" id="heading-{{ forloop.counter }}">
                                            <button class="accordion-button collapsed custom-accordion-header"
                                                    type="button"
                                                    data-bs-toggle="collapse"
                                                    data-bs-target="#collapse-{{ forloop.counter }}"
                                                    aria-expanded="false"
                                                    aria-controls="collapse-{{ forloop.counter }}">
                                                <div class="d-flex justify-content-between align-items-center w-100">
{#                                                <span class="d-flex align-items-center">#}
{#                                                    <i class="fas fa-folder me-2 text-info"></i>#}
{#                                                    {{ category }}#}
{#                                                </span>#}
                                                    <span class="d-flex align-items-center"
                                                          data-bs-toggle="tooltip"
                                                          data-bs-placement="top"
                                                          title="{% include 'code_analysis/category_tooltip.html' with name=category %}">
                                                        <i class="fas fa-folder me-2 text-info"></i>
                                                        {{ category }}
                                                    </span>

                                                    <span class="badge bg-info ms-2 text-dark fw-bold">{{ count }}</span>
                                                </div>
                                            </button>
                                        </h2>

                                        <div id="collapse-{{ forloop.counter }}" class="accordion-collapse collapse"
                                             aria-labelledby="heading-{{ forloop.counter }}" data-bs-parent="#categoryAccordion">
                                            <div class="accordion-body p-3 bg-secondary-subtle text-white rounded">

                                                {% for suggestion in suggestions %}
                                                    {% if suggestion.category == category %}
                                                        <div class="card mb-3 shadow-sm border-0" style="background-color: #212529;">
                                                            <div class="card-body">

                                                                <h6 class="text-primary fw-bold mb-2">
                                                                    <i class="fas fa-code"></i> CODE WITH ISSUE (LINE {{ suggestion.line }})
                                                                </h6>
                                                                <pre class="bg-black p-3 rounded text-white mb-3" style="font-family: 'Fira Code', monospace; white-space: pre-wrap;">{{ suggestion.code }}</pre>

                                                                <h6 class="text-warning fw-bold">
                                                                    <i class="fas fa-lightbulb"></i> AI-POWERED SUGGESTION
                                                                </h6>
                                                                <div class="bg-light text-dark p-3 rounded" style="white-space: pre-wrap; font-size: 0.95rem; border-left: 4px solid #ffc107;">
                                                                    {{ suggestion.suggestion | safe }}
                                                                </div>
                                                            </div>
                                                        </div>
                                                    {% endif %}
                                                {% endfor %}

                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>


                        <br><hr>
                        {#                        <h4>Severity Levels</h4>#}
                        {#                        <div class="severity-container">#}
                        {#                            <ul class="list-group">#}
                        {#                                {% for level, count in summary.severity.items %}#}
                        {#                                    <li class="list-group-item d-flex justify-content-between align-items-center severity-toggle"#}
                        {#                                        data-severity="{{ level }}">#}
                        {#                                        {{ level }}#}
                        {#                                        <span class="badge bg-warning rounded-pill">{{ count }}</span>#}
                        {#                                    </li>#}
                        {#                                    <div class="severity-details" id="{{ level|lower }}-details" style="display: none;">#}
                        {#                                        {% for suggestion in suggestions %}#}
                        {#                                            {% if suggestion.severity == level %}#}
                        {#                                                <div class="code-block">#}
                        {#                                                    <strong>Code With Issue (Line {{ suggestion.line }}):</strong>#}
                        {#                                                    <pre>{{ suggestion.code }}</pre>#}
                        {#                                                </div>#}
                        {#                                                <div class="suggestion-block">#}
                        {#                                                    <strong>Suggestion:</strong>#}
                        {#                                                    <pre>{{ suggestion.suggestion | safe }}</pre>#}
                        {#                                                </div>#}
                        {#                                            {% endif %}#}
                        {#                                        {% endfor %}#}
                        {#                                    </div>#}
                        {#                                {% endfor %}#}
                        {#                            </ul>#}
                        {#                        </div>#}

                        <div class="severity-section mt-5">
                            <h4 class="text-center text-light fw-bold mb-4">
                                🛡️ Severity Levels
                            </h4>

                            <div class="accordion accordion-flush" id="severityAccordion">
                                {% for level, count in summary.severity.items %}
                                    <div class="accordion-item bg-dark border-secondary rounded mb-3 shadow-sm">
                                        <h2 class="accordion-header" id="severity-heading-{{ forloop.counter }}">
                                            <button class="accordion-button collapsed custom-accordion-header"
                                                    type="button"
                                                    data-bs-toggle="collapse"
                                                    data-bs-target="#severity-collapse-{{ forloop.counter }}"
                                                    aria-expanded="false"
                                                    aria-controls="severity-collapse-{{ forloop.counter }}">
                                                <div class="d-flex justify-content-between align-items-center w-100">
{#                                                    <span class="d-flex align-items-center">#}
{#                                                        <i class="fas fa-shield-alt me-2 text-warning"></i>#}
{#                                                        {{ level }}#}
{#                                                    </span>#}
                                                    <span class="d-flex align-items-center"
                                                          data-bs-toggle="tooltip"
                                                          data-bs-placement="top"
                                                          title="{% include 'code_analysis/severity_tooltip.html' with level=level %}">
                                                        <i class="fas fa-shield-alt me-2 text-warning"></i>
                                                        {{ level }}
                                                    </span>

                                                    <span class="badge bg-warning ms-2 text-dark fw-bold">{{ count }}</span>
                                                </div>
                                            </button>
                                        </h2>

                                        <div id="severity-collapse-{{ forloop.counter }}"
                                             class="accordion-collapse collapse"
                                             aria-labelledby="severity-heading-{{ forloop.counter }}"
                                             data-bs-parent="#severityAccordion">
                                            <div class="accordion-body p-3 bg-secondary-subtle text-white rounded">
                                                {% for suggestion in suggestions %}
                                                    {% if suggestion.severity == level %}
                                                        <div class="card mb-3 shadow-sm border-0" style="background-color: #212529;">
                                                            <div class="card-body">
                                                                <h6 class="text-primary fw-bold mb-2">
                                                                    <i class="fas fa-code"></i> CODE WITH ISSUE (LINE {{ suggestion.line }})
                                                                </h6>
                                                                <pre class="bg-black p-3 rounded text-white mb-3" style="font-family: 'Fira Code', monospace; white-space: pre-wrap;">{{ suggestion.code }}</pre>

                                                                <h6 class="text-warning fw-bold">
                                                                    <i class="fas fa-lightbulb"></i> AI-POWERED SUGGESTION
                                                                </h6>
                                                                <div class="bg-light text-dark p-3 rounded" style="white-space: pre-wrap; font-size: 0.95rem; border-left: 4px solid #ffc107;">
                                                                    {{ suggestion.suggestion | safe }}
                                                                </div>
                                                            </div>
                                                        </div>
                                                    {% endif %}
                                                {% endfor %}
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Issue Category Distribution -->
                <div class="col-md-6">
                    <div class="chart-container p-3 shadow-sm rounded">
                        <h4 class="text-center">Code Analysis Issue Distribution</h4>
                        <canvas id="categoryChart" width="400" height="400"></canvas>
                    </div><br>
                    <div class="chart-container p-3 shadow-sm rounded">
                        <h4 class="text-center">Severity Level Distribution</h4>
                        <canvas id="severityChart" width="400" height="400" ></canvas>
                    </div>
                    <div class="chart-container p-3 shadow-sm rounded mt-4">
                        <h4 class="text-center">Java Code Complexity Metrics</h4>
                        <canvas id="javaComplexityChart" width="400" height="400"></canvas>
                    </div>
                    




                </div>
                <!-- Severity Level Distribution -->
                {#                <div class="col-md-6 ">#}
                {#                    <div class="chart-container p-3 shadow-sm rounded">#}
                {#                        <h4 class="text-center">Severity Level Distribution</h4>#}
                {#                        <canvas id="severityChart" width="400" height="400" ></canvas>#}
                {#                    </div>#}
                {#                </div>#}
            </div>
            <!-- Developer Guideline Section -->
            {% include 'code_analysis/before_after_comparison.html' with original_code=code fixed_code=fixed_code language='java'%}
            <div class="text-center mt-3">
                <a href="{% url 'export_java_excel' %}" class="btn btn-success">
                    <i class="fas fa-file-excel"></i> Download Excel Report
                </a>
            </div>
{#            {% if summary.total_wcc %}#}
{#                <div class="text-center mt-4">#}
{#                    <h5 class="text-warning">#}
{#                        🧮 Total Weighted Code Complexity (WCC): {{ summary.total_wcc }}#}
{#                    </h5>#}
{#                </div>#}
{#            {% endif %}#}
{##}
{#            {% if summary.method_complexities %}#}
{#                <div class="container mt-5">#}
{#                    <h3 class="text-center text-info mb-4">📊 Method Complexity Breakdown</h3>#}
{#                    <table class="table table-bordered table-hover table-dark text-center shadow">#}
{#                        <thead class="thead-light">#}
{#                        <tr>#}
{#                            <th>Method Name</th>#}
{#                            <th>S</th>#}
{#                            <th>W<sub>c</sub></th>#}
{#                            <th>W<sub>n</sub></th>#}
{#                            <th>W<sub>i</sub></th>#}
{#                            <th>W<sub>cc</sub></th>#}
{#                            <th>W<sub>tc</sub></th>#}
{#                            <th>W<sub>th</sub></th>#}
{#                            <th>W<sub>cbo</sub></th>#}
{#                            <th>Total</th>#}
{#                            <th>Category</th>#}
{#                        </tr>#}
{#                        </thead>#}
{#                        <tbody>#}
{#                        {% for metrics in summary.method_complexities %}#}
{#                            <tr#}
{#                                    {% if metrics.category == 'High' %}style="background-color: #f8d7da; color: #721c24;"{% endif %}#}
{#                                    {% if metrics.category == 'Medium' %}style="background-color: #fff3cd; color: #856404;"{% endif %}#}
{#                                    {% if metrics.category == 'Low' %}style="background-color: #d4edda; color: #155724;"{% endif %}#}
{#                            >#}
{#                                <td>{{ metrics.method_name }}</td>#}
{#                                <td>{{ metrics.size }}</td>#}
{#                                <td>{{ metrics.control_structure_complexity }}</td>#}
{#                                <td>{{ metrics.nesting_level }}</td>#}
{#                                <td>{{ metrics.inheritance_level }}</td>#}
{#                                <td>{{ metrics.compound_condition_weight }}</td>#}
{#                                <td>{{ metrics.try_catch_weight }}</td>#}
{#                                <td>{{ metrics.thread_weight }}</td>#}
{#                                <td>{{ metrics.cbo_weights }}</td>#}
{#                                <td>{{ metrics.total_complexity }}</td>#}
{#                                <td>{{ metrics.category }}</td>#}
{#                            </tr>#}
{#                        {% endfor %}#}
{#                        </tbody>#}
{#                    </table>#}
{#                </div>#}
{#            {% endif %}#}



            {% if final_guideline %}
                {#                <div class="container mt-5">#}
                {#                    <div class="guideline-panel p-4 shadow-lg rounded text-center">#}
                {#                        <h3 class="guideline-title mb-3">#}
                {#                            <i class="fas fa-lightbulb"></i> Final Coding Guideline#}
                {#                        </h3>#}
                {#                        <p class="guideline-content">{{ final_guideline | safe }}</p>#}
                {#                    </div>#}
                {#                </div>#}
                <div class="container mt-5">
                    <div class="guideline-panel p-4 shadow-lg rounded text-white" style="background: linear-gradient(145deg, #0f2027, #203a43, #2c5364); border-left: 6px solid #ffc107;">
                        <div class="text-center mb-4">
                            <h3 class="fw-bold text-warning">
                                <i class="fas fa-lightbulb"></i> General Coding Suggestions
                            </h3>
                            {#                        <p class="text-muted">Tailored AI Recommendations for Secure, Performant & Maintainable Code</p>#}
                        </div>

                        <div class="text-start" style="font-size: 1rem;">
                            {{ final_guideline | safe }}
                        </div>
                    </div>
                </div>
            {% endif %}

        </div>


        <!-- Analysis Results Section -->

    </div>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/js/all.min.js" crossorigin="anonymous"></script>
    <!-- Bootstrap 5 JS & Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF8ZRW3E6E4k/t8Hh7tY0fRS6P8qHcV9I6mDGM1If7HxhRDI3c" crossorigin="anonymous"></script>


    <!-- Chart.js for Graph -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>

    {#    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.js"></script>#}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/loader.min.js"></script>

    <!-- PrismJS Styles -->
    <link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet"/>
    <link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet"/>

    <!-- PrismJS Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-java.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>


    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const form = document.querySelector("form");

            form.addEventListener("submit", function () {
                // ✅ Show loading screen when form is submitted
                document.getElementById('loading-spinner').style.display = 'flex';
            });

            // ✅ Ensure the loading screen is hidden on page load
            window.onload = function () {
                document.getElementById('loading-spinner').style.display = 'none';
            };
        });
        document.addEventListener("DOMContentLoaded", function () {
            // Monaco Editor Initialization
            require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs' } });

            require(["vs/editor/editor.main"], function () {
                window.editor = monaco.editor.create(document.getElementById("monaco-container"), {
                    value: `{{ code|escapejs }}`,  // Load initial code if available
                    language: "javascript",
                    theme: "vs-dark",
                    automaticLayout: true,
                    minimap: { enabled: false },
                });
            });


        });
        // Handle file upload and display content in Monaco Editor
        document.getElementById('fileInput').addEventListener('change', function (event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    if (window.editor) {
                        window.editor.setValue(e.target.result);
                    }
                };
                reader.readAsText(file);
            }
        });

        // Ensure the form submits Monaco Editor content
        document.querySelector("form").addEventListener("submit", function () {
            let code = window.editor.getValue();
            let textarea = document.getElementById("codeEditor");
            textarea.value = code;
        });

        //file upload
        document.addEventListener("DOMContentLoaded", function () {
            const fileInput = document.getElementById("fileInput");
            const fileNameDisplay = document.getElementById("fileNameDisplay");
            const uploadContainer = document.querySelector(".upload-container");

            // ✅ Prevent the default browser behavior when dragging files over the drop zone
            uploadContainer.addEventListener("dragover", function (event) {
                event.preventDefault();
                event.stopPropagation();
                uploadContainer.style.background = "#e0f2ff"; // Highlight effect
            });

            uploadContainer.addEventListener("dragleave", function (event) {
                event.preventDefault();
                event.stopPropagation();
                uploadContainer.style.background = "#f8f9fa"; // Reset background
            });

            uploadContainer.addEventListener("drop", function (event) {
                event.preventDefault();
                event.stopPropagation();
                uploadContainer.style.background = "#f8f9fa"; // Reset background

                const files = event.dataTransfer.files;
                if (files.length > 0) {
                    fileInput.files = files; // Assign dropped files to input
                    let fileList = Array.from(files).map(file => file.name).join(", ");
                    fileNameDisplay.textContent = `Selected Files: ${fileList}`;

                    // ✅ Read file content and display it in Monaco Editor
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        if (window.editor) {
                            window.editor.setValue(e.target.result);
                        }
                    };
                    reader.readAsText(files[0]); // Read only the first file's content
                }
            });

            // ✅ Handle file selection from input
            fileInput.addEventListener("change", function () {
                if (this.files.length > 0) {
                    let fileList = Array.from(this.files).map(file => file.name).join(", ");
                    fileNameDisplay.textContent = `Selected Files: ${fileList}`;
                } else {
                    fileNameDisplay.textContent = "";
                }
            });
        });



        ///github modal
        document.addEventListener("DOMContentLoaded", function () {
            const githubBtn = document.getElementById("githubBtn");
            const githubModal = document.getElementById("githubModal");
            const analyzeGithubBtn = document.getElementById("analyzeGithubBtn");
            const closeGithubBtn = document.getElementById("closeGithubBtn");
            const githubRepoUrl = document.getElementById("githubRepoUrl");
            const fileSelector = document.getElementById("fileSelector"); // Dropdown for file selection
            let fetchedFiles = []; // Store fetched files

            // Open modal
            githubBtn.addEventListener("click", function (event) {
                event.preventDefault();
                githubModal.style.display = "block";
            });

            // Close modal
            closeGithubBtn.addEventListener("click", function (event) {
                event.preventDefault();
                githubModal.style.display = "none";
            });

            // Handle GitHub analysis
            analyzeGithubBtn.addEventListener("click", function (event) {
                event.preventDefault();
                const repoUrl = githubRepoUrl.value.trim();

                if (!repoUrl) {
                    alert("Please enter a GitHub repository URL.");
                    return;
                }

                fetch("{% url 'analyze_code' %}", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "X-CSRFToken": "{{ csrf_token }}" // CSRF token for security
                    },
                    body: JSON.stringify({ github_url: repoUrl })
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.error) {
                            alert("Error fetching GitHub files: " + data.error);
                        } else {
                            fetchedFiles = data.files; // Store files for reference
                            fileSelector.innerHTML = ""; // Clear previous options

                            // ✅ Add "All" option to dropdown
                            let allOption = document.createElement("option");
                            allOption.value = "all";
                            allOption.textContent = "All Files";
                            fileSelector.appendChild(allOption);

                            // ✅ Add each file to dropdown
                            data.files.forEach((file, index) => {
                                let option = document.createElement("option");
                                option.value = index;
                                option.textContent = file.name;
                                fileSelector.appendChild(option);
                            });

                            if (fetchedFiles.length > 0) {
                                updateEditorWithFile(0); // Load the first file
                            }
                        }
                    })
                    .catch(error => {
                        console.error("Error:", error);
                        alert("Failed to fetch GitHub files.");
                    });

                githubModal.style.display = "none";
            });

            // Function to update Monaco Editor with selected file or all files
            function updateEditorWithFile(index) {
                if (index === "all") {
                    let combinedCode = fetchedFiles.map(file => `# File: ${file.name}\n${file.code}`).join("\n\n");
                    if (window.editor) {
                        window.editor.setValue(combinedCode);
                    }
                } else {
                    const selectedFile = fetchedFiles[index];
                    if (selectedFile) {
                        if (window.editor) {
                            window.editor.setValue(selectedFile.code);
                        }
                    }
                }
            }

            // Change Monaco Editor content when a new file is selected
            fileSelector.addEventListener("change", function () {
                updateEditorWithFile(this.value === "all" ? "all" : parseInt(this.value));
            });
        });


        //complexity chart
        document.addEventListener("DOMContentLoaded", function () {
            // Ensure summary data exists before rendering the chart
            const complexityMetrics = {
                "Lines of Code": {{ summary.complexity_metrics.lines_of_code|default:0 }},
                "Effective LOC": {{ summary.complexity_metrics.effective_lines_of_code|default:0 }},
                "Classes": {{ summary.complexity_metrics.num_classes|default:0 }},
                "Methods": {{ summary.complexity_metrics.num_methods|default:0 }},
                "Avg. Method Length": {{ summary.complexity_metrics.avg_method_length|default:0 }},
                "Nesting Depth": {{ summary.complexity_metrics.nesting_depth|default:0 }},
                "Duplicate Code (%)": {{ summary.complexity_metrics.duplicate_code_percentage|default:0 }},
                "Comment Density": {{ summary.complexity_metrics.comment_density|default:0 }},
                "Readability Score": {{ summary.complexity_metrics.readability_score|default:0 }},
                "Complexity Score": {{ summary.complexity_metrics.complexity_score|default:0 }}
            };

            // Ensure at least one non-zero value is available before rendering
            if (Object.values(complexityMetrics).some(value => value > 0)) {
                const ctx = document.getElementById("javaComplexityChart").getContext("2d");

                new Chart(ctx, {
                    type: "bar",
                    data: {
                        labels: Object.keys(complexityMetrics),
                        datasets: [{
                            label: "Java Code Complexity Metrics",
                            data: Object.values(complexityMetrics),
                            backgroundColor: [
                                "#FF5733", "#33FFBD", "#337AFF", "#FF33E3",
                                "#FFCE33", "#33FF57", "#A833FF", "#FF8333", "#FFC300", "#DAF7A6"
                            ],
                            borderColor: "#FFFFFF",
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: { color: "#FFFFFF" }
                            },
                            x: {
                                ticks: { color: "#FFFFFF" }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false  // Hide the legend
                            }
                        }
                    }
                });
            } else {
                console.warn("No valid complexity metrics found.");
            }
        });


        //toast messages
        document.addEventListener("DOMContentLoaded", function () {
            // Function to show Bootstrap toast messages
            function showToast(message, type = "primary") {
                const toastElement = document.getElementById("generalToast");
                const toastMessage = document.getElementById("toastMessage");

                // Update message and class based on type
                toastMessage.innerHTML = message;
                toastElement.className = `toast align-items-center text-white bg-${type} border-0`;

                // Show toast
                const toast = new bootstrap.Toast(toastElement);
                toast.show();
            }

            // 🎯 1️⃣ Show Toast When Uploading a File
            document.getElementById('fileInput').addEventListener('change', function () {
                if (this.files.length > 0) {
                    showToast("📂 File uploaded successfully!", "success");
                }
            });

            // 🎯 2️⃣ Show Toast When Importing from GitHub
            document.getElementById("analyzeGithubBtn").addEventListener("click", function () {
                const repoUrl = document.getElementById("githubRepoUrl").value.trim();
                if (repoUrl) {
                    showToast("🔄 Fetching repository data from GitHub...", "info");
                } else {
                    showToast("⚠️ Please enter a valid GitHub repository URL!", "danger");
                }
            });

            // 🎯 3️⃣ Show Toast When Analysis Begins
            document.querySelector("form").addEventListener("submit", function () {
                showToast("⚡ Code analysis started. Please wait...", "warning");
            });

            // 🎯 4️⃣ Show Toast When Analysis Results Are Available
            const analysisResults = document.getElementById("analysis-results");
            if (analysisResults && analysisResults.innerHTML.trim().length > 0) {
                showToast("✅ Code analysis completed!", "success");
            }
        });






        document.addEventListener("DOMContentLoaded", function () {

            Chart.defaults.color = "#ffffff"; // ✅ Make all text white
            Chart.defaults.font.size = 12; // ✅ Adjust font size for better visibility
            // Toggle severity details
            document.querySelectorAll(".severity-toggle").forEach(item => {
                item.addEventListener("click", function () {
                    const severity = this.getAttribute("data-severity").toLowerCase();
                    const details = document.getElementById(severity + "-details");

                    if (details.style.display === "none") {
                        details.style.display = "block";
                    } else {
                        details.style.display = "none";
                    }
                });
            });


            const severityChart = new Chart(document.getElementById('severityChart'), {
                type: 'pie',
                data: {
                    labels: Object.keys({{ summary.severity|safe }}),
                    datasets: [{
                        label: 'Severity Levels',
                        data: Object.values({{ summary.severity|safe }}),
                        backgroundColor: ['#FF6384', '#FFCE56', '#4BC0C0'],
                        borderColor: ['#FF6384', '#FFCE56', '#4BC0C0'],
                        borderWidth: 1
                    }]
                },
            });
        });

        document.addEventListener("DOMContentLoaded", function () {
            document.querySelectorAll(".category-toggle").forEach(item => {
                item.addEventListener("click", function () {
                    const category = this.getAttribute("data-category");
                    const details = document.getElementById(category.replace(/\s+/g, '-').toLowerCase() + "-details");

                    if (details) {
                        details.style.display = details.style.display === "none" ? "block" : "none";
                    }
                });
            });

            // Define more colors for categories
            const colorPalette = [
                'rgba(75, 192, 192, 1)',   // Teal
                'rgba(153, 102, 255, 1)',  // Purple
                'rgba(255, 159, 64, 1)',   // Orange
                'rgba(255, 99, 132, 1)',   // Red
                'rgba(54, 162, 235, 1)',   // Blue
                'rgba(255, 205, 86, 1)',   // Yellow
                'rgba(46, 204, 113, 1)',   // Green
                'rgba(231, 76, 60, 1)',    // Dark Red
                'rgba(241, 196, 15, 1)',   // Bright Yellow
                'rgba(155, 89, 182, 1)',   // Deep Purple
                'rgba(52, 152, 219, 1)',   // Sky Blue
                'rgba(39, 174, 96, 1)',    // Leaf Green
                'rgba(243, 156, 18, 1)'    // Orange-Yellow
            ];

            const borderColorPalette = colorPalette.map(color => color.replace("1", "1")); // Darker border colors

            // Generate category chart
            const categoryLabels = Object.keys({{ summary.categories|safe }});
            const categoryDataValues = Object.values({{ summary.categories|safe }});

            const categoryChart = new Chart(document.getElementById('categoryChart'), {
                type: 'pie',
                data: {
                    labels: categoryLabels,
                    datasets: [{
                        label: 'Categories',
                        data: categoryDataValues,
                        backgroundColor: categoryLabels.map((_, index) => colorPalette[index % colorPalette.length]), // Cycle colors
                        borderColor: categoryLabels.map((_, index) => borderColorPalette[index % borderColorPalette.length]), // Cycle border colors
                        borderWidth: 1
                    }]
                }
            });
        });



        // Severity Level Distribution Chart
        const severityData = {
            labels: Object.keys({{ summary.severity|safe }}),
            datasets: [{
                label: 'Severity Levels',
                data: Object.values({{ summary.severity|safe }}),
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)', // Critical - Red
                    'rgba(255, 206, 86, 0.2)', // Medium - Yellow
                    'rgba(75, 192, 192, 0.2)', // Low - Green
                ],
                borderColor: [
                    'rgba(255, 99, 132, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 192, 192, 1)',
                ],
                borderWidth: 1
            }]
        };


        // Handle file upload and display content in the editor
        document.getElementById('fileInput').addEventListener('change', function (event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    codeMirrorEditor.setValue(e.target.result);
                };
                reader.readAsText(file);
            }
        });

        document.addEventListener('DOMContentLoaded', function () {
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.forEach(function (tooltipTriggerEl) {
                new bootstrap.Tooltip(tooltipTriggerEl, {
                    trigger: 'hover',
                    animation: true,
                    placement: 'top',
                    boundary: 'window'
                });
            });
        });


    </script>



    <style>
        /* General Background and Text Adjustments for Dark Mode */
        .dark-mode {
            background-color: #121212; /* Deep dark background */
            color: #ffffff; /* Ensure text remains white */
        }

        /* Ensure Containers Stand Out in Dark Mode */
        .summary-panel,
        .chart-container,
        .severity-container,
        .category-container,
        .recommendation-container {
            background-color: #1a1f3b !important; /* Deep navy blue */
            color: #ffffff !important;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0px 0px 8px rgba(0, 123, 255, 0.2); /* Subtle glow effect */
        }

        .recommendation-container {
            background-color: #232a45 !important; /* Slightly lighter navy */
            color: #ffffff !important;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0px 0px 8px rgba(0, 123, 255, 0.2); /* Subtle glow effect */
            max-height: 550px; /* Fixed height */
            overflow-y: auto; /* Enable scrolling */
        }
        /* Fix Clickable Elements */
        .category-toggle,
        .severity-toggle,
        .upload-container,
        .upload-box,
        .btn-github,
        .github-modal-content .btn,
        .list-group-item,
        .nav-link {
            cursor: pointer !important; /* ✅ Forces the hand cursor */
        }
        /* Improve Contrast for Code Blocks */
        .code-block {
            background-color: #232a45 !important; /* Slightly lighter navy */
            border: 1px solid #007bff !important; /* Bright blue border */
            color: #ffffff !important;
            padding: 12px;
            border-radius: 6px;
            box-shadow: 0px 0px 5px rgba(0, 123, 255, 0.2);
        }

        /* Suggestions Should Stand Out */
        .suggestion-block {
            background-color: #1b3a31 !important; /* Dark teal */
            border: 1px solid #28a745 !important; /* Green border */
            color: #ffffff !important;
            padding: 12px;
            border-radius: 6px;
            box-shadow: 0px 0px 5px rgba(40, 167, 69, 0.3); /* Subtle green glow */
        }
        .suggestion-block pre {
            white-space: pre-wrap; /* Ensures wrapping */
            word-wrap: break-word; /* Break long words if necessary */
            overflow-wrap: break-word; /* Ensures content breaks properly */
            max-width: 100%; /* Prevents it from exceeding the parent container */
            background-color: transparent; /* Keep same background as parent */
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            overflow-x: auto; /* Allows horizontal scrolling if needed */
        }

        /* Ensure Toggle Elements are Readable */
        .category-toggle,
        .severity-container {
            background-color: #212d48 !important; /* Deep blue */
            color: white !important;
            border: 1px solid rgba(255, 255, 255, 0.3); /* Light border */
            border-radius: 8px;
            padding: 15px;
        }

        /* ✅ Improve Expandable Category Details */
        .category-details,
        .severity-details {
            background-color: #1f2638 !important;
            border: 1px solid #007bff !important;
            padding: 10px;
            border-radius: 6px;
            max-height: 250px; /* Fixed height */
            overflow-y: auto; /* Enable scrolling */
            transition: all 0.3s ease-in-out;
        }

        /* ✨ Improve Category Toggle */
        .category-toggle,
        .severity-toggle {
            color: #f1c40f !important; /* Golden yellow */
            font-weight: bold;
            cursor: pointer !important;
        }

        /* 📌 Improve List Items */
        .list-group-item {
            background-color: #2a3550 !important; /* Dark blue */
            color: #ffffff !important;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .category-toggle:hover,
        .severity-toggle:hover {
            color: #ffcc00 !important; /* Bright yellow on hover */
        }

        .list-group-item:hover {
            background-color: #36456b !important; /* Lighter navy on hover */
        }

        /* Make Uploaded File Name Visible */
        #fileNameDisplay {
            color: #ffffff !important;
        }

        /* Make Upload Box More Visible */
        .upload-container {
            border: 2px dashed #007bff;
            background: rgba(0, 123, 255, 0.1) !important; /* Subtle blue tint */
        }

        .upload-box {
            color: #007bff !important; /* Text should match your theme */
        }

        /* Improve Button Visibility */
        .btn-github {
            background-color: #007bff !important;
            color: white !important;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }

        .btn-github:hover {
            background-color: white !important;
            color: #007bff !important;
        }

        /* Adjust the Chart Labels */
        .chart-container canvas {
            color: white !important;
        }

        /* Ensure Form Labels are Readable */
        .form-label {
            color: white !important;
        }


        /* Custom GitHub Button Styling */
        .btn-github {
            background: #007bff !important; /* ✅ Bright Blue */
            color: white !important;
            border-radius: 8px;
            font-weight: 500;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            border: none;
            text-shadow: 0px 0px 2px rgba(0, 0, 0, 0.2); /* ✅ Subtle shadow for better visibility */
        }

        /* Ensure the icon is also visible */
        .btn-github i {
            color: white !important; /* ✅ Make sure the GitHub icon is visible */
            margin-right: 8px;
            font-size: 18px;
        }

        /* Hover Effect */
        .btn-github:hover {
            background: white !important; /* ✅ Invert colors for better contrast */
            color: #007bff !important;
            transform: translateY(-2px);
        }

        /* Active (Click) Effect */
        .btn-github:active {
            transform: scale(0.98);
        }

        /* Extra Fix: Ensure Dark Mode Doesn't Override Styles */
        .dark-mode .btn-github {
            background: #007bff !important;
            color: white !important;
            border: 2px solid #007bff;
        }



        /* GitHub Import Modal */
        /* GitHub Import Modal */
        .github-modal {
            display: none; /* Initially hidden */
            position: fixed;
            z-index: 1050; /* Higher than normal elements */
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 420px;
            background: #2c3e50; /* Modern dark blue */
            padding: 25px;
            border-radius: 12px; /* Softer edges */
            box-shadow: 0px 10px 30px rgba(0, 0, 0, 0.3);
            text-align: center;
            color: white; /* White text for contrast */
        }

        /* Modal Background Overlay */
        .github-modal::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6); /* Darker overlay for focus */
            z-index: -1;
        }

        /* Modal Content */
        .github-modal-content {
            padding: 20px;
        }

        /* Modal Header */
        .github-modal h4 {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #f1c40f; /* Yellow-Gold heading */
        }

        /* Input Field */
        .github-modal input {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: none;
            margin-top: 10px;
            background: #ecf0f1; /* Light gray background */
            color: #333;
            font-size: 16px;
        }

        /* Buttons inside the modal */
        .github-modal-content .btn {
            margin: 5px;
            padding: 10px 16px;
            font-size: 14px;
            border-radius: 8px;
            transition: all 0.2s ease-in-out;
        }

        /* Analyze Button */
        #analyzeGithubBtn {
            background: #27ae60; /* Green */
            color: white;
            border: none;
        }

        #analyzeGithubBtn:hover {
            background: #219150;
        }

        /* Close Button */
        #closeGithubBtn {
            background: #e74c3c; /* Red */
            color: white;
            border: none;
        }

        #closeGithubBtn:hover {
            background: #c0392b;
        }
        /* 🔥 Developer Guideline Section */

        .guideline-panel {
            background: linear-gradient(135deg, #1e3c72, #2a5298); /* Sleek dark-blue gradient */
            color: white; /* White text for better contrast */
            border-radius: 12px;
            box-shadow: 0px 12px 30px rgba(0, 0, 0, 0.4); /* More prominent shadow */
            padding: 30px;
            max-width: 850px;
            margin: auto;
            transition: transform 0.3s ease-in-out;
            border-left: 5px solid #f1c40f; /* Gold accent on the left */
        }

        /* Hover Effect */
        .guideline-panel:hover {
            transform: translateY(-5px); /* Slight elevation on hover */
        }

        /* Title Styling */
        .guideline-title {
            font-size: 26px;
            font-weight: bold;
            color: #f1c40f; /* Gold for highlighting */
            text-shadow: 1px 1px 4px rgba(255, 204, 0, 0.5); /* Glowing effect */
        }

        /* Content Styling */
        .guideline-content {
            font-size: 18px;
            line-height: 1.6;
            text-align: center;
            padding: 15px;
            font-weight: 500;
        }

        /* Smooth Fade-in Effect */
        .guideline-panel {
            opacity: 0;
            animation: fadeIn 0.8s ease-in-out forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(15px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }


        .upload-container {
            background: rgba(255, 255, 255, 0.05); /* Light transparency */
            border: 2px dashed #0D92F4;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s ease-in-out;
            cursor: pointer;
            color: #007bff !important; /* 🔵 Ensure text is visible */
        }

        .upload-box {
            font-size: 16px;
            font-weight: bold;
            text-align: center;
            color: #007bff !important; /* 🔵 Ensure text remains visible */
        }

        .upload-container:hover {
            background: rgba(255, 255, 255, 0.1); /* Slightly brighter on hover */
            border-color: #0056b3;
        }

        .upload-box i {
            color: #007bff !important; /* Ensure icon is visible */
        }

        .custom-dropdown {
            font-weight: bold;
            border-radius: 8px;
            padding: 10px;
            background: #f8f9fa;
            transition: all 0.3s ease-in-out;
        }

        /* Change dropdown hover effect */
        .custom-dropdown:hover {
            background: #e9ecef;
        }

        /* Style Monaco Editor Container */
        #monaco-container {
            height: 400px;
            border: 2px solid #007bff;
            border-radius: 8px;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
        }
        /* loader */
        .dots-loader {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .dots-loader span {
            width: 15px;
            height: 15px;
            margin: 5px;
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out both;
        }

        /* Assign different colors to each dot */
        .dots-loader .red {
            background-color: #ff4d4d; /* Red */
            animation-delay: -0.32s;
        }

        .dots-loader .yellow {
            background-color: #ffd700; /* Yellow */
            animation-delay: -0.16s;
        }

        .dots-loader .green {
            background-color: #4caf50; /* Green */
            animation-delay: 0s;
        }

        .dots-loader .blue {
            background-color: #1e90ff; /* Blue */
            animation-delay: 0.16s;
        }

        @keyframes bounce {
            0%, 80%, 100% {
                transform: scale(0);
            }
            40% {
                transform: scale(1);
            }
        }

        .suggestion-card {
            border-left: 4px solid #ffc107;
            transition: all 0.3s ease;
        }
        .suggestion-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 15px rgba(0,0,0,0.2);
        }
        .suggestion-content {
            background-color: #2c2c3a;
            border-left: 4px solid #28a745;
        }

        .tooltip-inner {
            background-color: #2c2f3f !important;
            color: #ffffff !important;
            padding: 10px 14px !important;
            font-size: 0.85rem;
            font-weight: 500;
            max-width: 300px;
            text-align: left;
            border-radius: 0.5rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .bs-tooltip-top .tooltip-arrow::before,
        .bs-tooltip-auto[data-popper-placement^="top"] .tooltip-arrow::before {
            border-top-color: #2c2f3f !important;
        }
        .bs-tooltip-bottom .tooltip-arrow::before,
        .bs-tooltip-auto[data-popper-placement^="bottom"] .tooltip-arrow::before {
            border-bottom-color: #2c2f3f !important;
        }
        .bs-tooltip-left .tooltip-arrow::before,
        .bs-tooltip-auto[data-popper-placement^="left"] .tooltip-arrow::before {
            border-left-color: #2c2f3f !important;
        }
        .bs-tooltip-right .tooltip-arrow::before,
        .bs-tooltip-auto[data-popper-placement^="right"] .tooltip-arrow::before {
            border-right-color: #2c2f3f !important;
        }

        .category-section {
            max-width: 850px;
            margin: 0 auto;
        }

        .severity-section {
            max-width: 850px;
            margin: 0 auto;
        }

        /* Accordion header */
        .custom-accordion-header {
            background: linear-gradient(145deg, #3a0ca3, #4361ee) !important;
            color: #ffffff;
            font-weight: 500;
            border-radius: 0.5rem;
            transition: all 0.2s ease-in-out;
        }

        .accordion-button:not(.collapsed) {
            color: #ffffff !important;
            background: linear-gradient(145deg, #3a0ca3, #4361ee) !important;
        }

        .custom-accordion-header:hover {
            background: linear-gradient(145deg, #4c2aad, #5078f2) !important;
        }

        /* Badge styling */
        .badge.bg-info {
            background-color: #00cfff !important;
            font-size: 0.85rem;
            padding: 0.35em 0.65em;
            border-radius: 12px;
            min-width: 32px;
            text-align: center;
        }

        /* Accordion body */
        .accordion-body {
            background-color: #1e1e2f;
            border-radius: 0.5rem;
            max-height: 450px;       /* 👈 Adjust this value as needed */
            overflow-y: auto;
        {#padding-right: 10px;#}
            padding: 1rem;
        }

        /* Optional: Add scrollbar styling for better UX */
        .accordion-body::-webkit-scrollbar {
            width: 8px;
        }
        .accordion-body::-webkit-scrollbar-track {
            background: transparent;
        }
        .accordion-body::-webkit-scrollbar-thumb {
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
        }

        /* Code card styles */
        .card-body pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Fira Code', monospace;
        }

        .card {
            background-color: #2d2d3a;
            border-radius: 0.5rem;
        }

        .card-body h6 {
            font-size: 1rem;
            margin-bottom: 0.5rem;
        }

        .bg-light.text-dark {
            background-color: #f5f5f5 !important;
            color: #212529 !important;
            border-left: 4px solid #ffc107;
        }

        .guideline-panel ul {
            padding-left: 1.5rem;
            margin-bottom: 1rem;
        }

        .guideline-panel ul li {
            margin-bottom: 0.75rem;
            line-height: 1.6;
        }

        .guideline-panel h4 {
            margin-top: 1.5rem;
            font-weight: 600;
            color: #ffc107;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .guideline-panel h3 {
            font-size: 1.6rem;
        }

        .card-header.bg-primary {
            background: linear-gradient(to right, #007bff, #0056b3);
            border-bottom: 1px solid #004999;
        }

        input#guidelineFile::file-selector-button {
            background-color: #0056b3;
            color: #fff;
            border: none;
            padding: 0.3rem 1rem;
            border-radius: 0.25rem;
            margin-right: 10px;
            cursor: pointer;
        }


    </style>


{% endblock %}