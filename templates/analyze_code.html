{% extends 'base.html' %}

{% block content %}
    <h1 class="text-center mb-4">AI Code Analyzer</h1>

    <nav class="mb-4">
        <ul class="nav justify-content-center">
            <li class="nav-item">
                <a class="nav-link btn btn-outline-primary" href="{% url 'java_code_analysis' %}">Java Code Analyzer</a>
            </li>
            <li class="nav-item">
                <a class="nav-link btn btn-outline-primary" href="{% url 'python_code_analysis' %}">Python Code Analyzer</a>
            </li>
            <li class="nav-item">
                <a class="nav-link btn btn-outline-primary" href="{% url 'js_code_analyser' %}">JavaScript Analyzer</a>
            </li>
        </ul>
    </nav>

    <div class="container">
        <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="mb-3">
                <label for="fileInput" class="form-label">Upload File(s):</label>
                <input type="file" name="files" id="fileInput" class="form-control mb-3" multiple>
            </div>
            <!-- Button to Open Modal -->
            <div class="text-center mb-3">
                <button id="githubBtn" class="btn btn-lg btn-github">
                    <i class="fab fa-github"></i> Import from GitHub
                </button>
            </div>


            <div class="mb-3">
                <label class="form-label">Paste Code Below:</label>
                <div id="monaco-container" style="height: 400px; border: 1px solid #ccc;"></div>
                <textarea id="codeEditor" name="code" style="display: none;">{{ code }}</textarea>
            </div>
            <div class="text-center mt-3">
                <button type="submit" class="btn btn-lg btn-primary px-4 py-2 shadow-sm rounded-pill" style="background: linear-gradient(135deg, #007bff, #0056b3); border: none; font-weight: bold; transition: 0.3s;">
                    <i class="fas fa-search"></i> Analyze Code
                </button>
            </div>

        </form>

        <!-- GitHub Repository Modal (Initially Hidden) -->
        <div id="githubModal" class="github-modal">
            <div class="github-modal-content">
                <h4 class="text-center"><i class="fab fa-github"></i> Import from GitHub</h4>
                <p class="text-center">Enter the GitHub repository URL to analyze.</p>

                <input type="text" id="githubRepoUrl" class="form-control"
                       placeholder="Enter GitHub Repo URL (e.g., https://github.com/user/repo)">

                <div class="text-center mt-3">
                    <button id="analyzeGithubBtn" class="btn">Analyze</button>
                    <button id="closeGithubBtn" class="btn">Close</button>
                </div>
            </div>
        </div>

        <!-- Hidden Form to Submit GitHub URL -->
        <form id="githubForm" method="POST" action="{% url 'analyze_code' %}">
            {% csrf_token %}
            <input type="hidden" name="github_url" id="githubRepoInput">
        </form>

        <!-- GitHub Repository Modal (Enhanced) -->
        <!-- GitHub Repository Modal -->
{#        <div id="githubModal" class="modal fade" tabindex="-1" aria-labelledby="githubModalLabel">#}
{#            <div class="modal-dialog modal-dialog-centered">#}
{#                <div class="modal-content shadow-lg border-0">#}
{#                    <div class="modal-header bg-dark text-white">#}
{#                        <h5 class="modal-title" id="githubModalLabel">#}
{#                            <i class="fab fa-github"></i> Import from GitHub#}
{#                        </h5>#}
{#                        <button type="button" class="btn-close text-white" data-bs-dismiss="modal" aria-label="Close"></button>#}
{#                    </div>#}
{#                    <div class="modal-body">#}
{#                        <p class="text-muted text-center">Enter the GitHub repository URL to analyze.</p>#}
{##}
{#                        <div class="input-group">#}
{#                            <span class="input-group-text"><i class="fas fa-link"></i></span>#}
{#                            <input type="text" id="githubRepoUrl" class="form-control"#}
{#                                   placeholder="https://github.com/user/repo">#}
{#                        </div>#}
{#                    </div>#}
{#                    <div class="modal-footer d-flex justify-content-between">#}
{#                        <button type="button" class="btn btn-secondary shadow-sm" data-bs-dismiss="modal">#}
{#                            <i class="fas fa-times"></i> Close#}
{#                        </button>#}
{#                        <button id="analyzeGithubBtn" class="btn btn-success shadow-sm">#}
{#                            <i class="fas fa-search"></i> Analyze#}
{#                        </button>#}
{#                    </div>#}
{#                </div>#}
{#            </div>#}
{#        </div>#}
{##}
{#        <!-- Hidden Form to Submit GitHub URL -->#}
{#        <form id="githubForm" method="POST" action="{% url 'analyze_code' %}">#}
{#            {% csrf_token %}#}
{#            <input type="hidden" name="github_url" id="githubRepoInput">#}
{#        </form>#}



        <div id="analysis-results" class="mt-4">
            {% if suggestions %}
                <h2 class="text-center mb-4">Analysis Results:</h2>
                <div class="recommendation-container scrollable-container">
                    {% for suggestion in suggestions %}
                        <div class="code-block">
                            <strong>Code With Issue:</strong>
                            <pre>{{ suggestion.code }}</pre>
                        </div>
                        <div class="suggestion-block">
                            <strong>Suggestion:</strong>
                            <pre>{{ suggestion.suggestion | safe}}</pre>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="text-center">No recommendations available. Paste or upload code to analyze.</p>
            {% endif %}
        </div>

        <!-- Summary Report Section -->
        <div class="container mt-4">
            <div class="row">
                <div class="col-md-6">
                    <div class="summary-panel p-3 shadow-sm rounded">
                        <h3 class="text-center">Code Analysis Summary Report</h3><br>
                        <p><strong>Total Code Segments Analyzed:</strong> {{ summary.total_snippets }}</p>
                        <p><strong>Total Suggestions:</strong> {{ summary.total_suggestions }}</p>
                        <p><strong>Total Code Lines Processed:</strong> {{ summary.total_lines }}</p>

                        <!-- Code Complexity Metrics Section -->
                        {% include 'code_analysis/complexity_metrics.html' %}



                        <hr>
                        <h4>Categories</h4>
{#                        <ul class="list-group">#}
{#                            {% for category, count in summary.categories.items %}#}
{#                                <li class="list-group-item d-flex justify-content-between align-items-center">#}
{#                                    {{ category }}#}
{#                                    <span class="badge bg-primary rounded-pill">{{ count }}</span>#}
{#                                </li>#}
{#                            {% endfor %}#}
{#                        </ul>#}
                        <div class="category-container">
                            <ul class="list-group">
                                {% for category, count in summary.categories.items %}
                                    <li class="list-group-item d-flex justify-content-between align-items-center category-toggle"
                                        data-category="{{ category }}">
                                        {{ category }}
                                        <span class="badge bg-primary rounded-pill">{{ count }}</span>
                                    </li>
                                    <div class="category-details" id="{{ category|slugify }}-details" style="display: none;">
                                        {% for suggestion in suggestions %}
                                            {% if suggestion.category == category %}
                                                <div class="code-block">
                                                    <strong>Code With Issue (Line {{ suggestion.line }}):</strong>
                                                    <pre>{{ suggestion.code }}</pre>
                                                </div>
                                            {% endif %}
                                        {% endfor %}
                                    </div>
                                {% endfor %}
                            </ul>
                        </div>

                    <br><hr>
                        <h4>Severity Levels</h4>
                        <div class="severity-container">
                            <ul class="list-group">
                                {% for level, count in summary.severity.items %}
                                    <li class="list-group-item d-flex justify-content-between align-items-center severity-toggle"
                                        data-severity="{{ level }}">
                                        {{ level }}
                                        <span class="badge bg-warning rounded-pill">{{ count }}</span>
                                    </li>
                                    <div class="severity-details" id="{{ level|lower }}-details" style="display: none;">
                                        {% for suggestion in suggestions %}
                                            {% if suggestion.severity == level %}
                                                <div class="code-block">
                                                    <strong>Code With Issue (Line {{ suggestion.line }}):</strong>
                                                    <pre>{{ suggestion.code }}</pre>
                                                </div>
                                                <div class="suggestion-block">
                                                    <strong>Suggestion:</strong>
                                                    <pre>{{ suggestion.suggestion }}</pre>
                                                </div>
                                            {% endif %}
                                        {% endfor %}
                                    </div>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
                <!-- Issue Category Distribution -->
                <div class="col-md-6">
                    <div class="chart-container p-3 shadow-sm rounded">
                        <h4 class="text-center">Code Analysis Issue Distribution</h4>
                        <canvas id="categoryChart" width="400" height="400"></canvas>
                    </div><br>
                    <div class="chart-container p-3 shadow-sm rounded">
                        <h4 class="text-center">Severity Level Distribution</h4>
                        <canvas id="severityChart" width="400" height="400" ></canvas>
                    </div>
                </div>
                <!-- Severity Level Distribution -->
{#                <div class="col-md-6 ">#}
{#                    <div class="chart-container p-3 shadow-sm rounded">#}
{#                        <h4 class="text-center">Severity Level Distribution</h4>#}
{#                        <canvas id="severityChart" width="400" height="400" ></canvas>#}
{#                    </div>#}
{#                </div>#}
            </div>
        </div>


        <!-- Analysis Results Section -->

    </div>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/js/all.min.js" crossorigin="anonymous"></script>
    <!-- Bootstrap 5 JS & Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF8ZRW3E6E4k/t8Hh7tY0fRS6P8qHcV9I6mDGM1If7HxhRDI3c" crossorigin="anonymous"></script>


    <!-- Chart.js for Graph -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{#    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.js"></script>#}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/loader.min.js"></script>


    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Monaco Editor Initialization
            require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs' } });

            require(["vs/editor/editor.main"], function () {
                window.editor = monaco.editor.create(document.getElementById("monaco-container"), {
                    value: `{{ code|escapejs }}`,  // Load initial code if available
                    language: "javascript",
                    theme: "vs-dark",
                    automaticLayout: true,
                    minimap: { enabled: false },
                });
            });

            // Handle file upload and display content in Monaco Editor
            document.getElementById('fileInput').addEventListener('change', function (event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        if (window.editor) {
                            window.editor.setValue(e.target.result);
                        }
                    };
                    reader.readAsText(file);
                }
            });

            // Ensure the form submits Monaco Editor content
            document.querySelector("form").addEventListener("submit", function () {
                let code = window.editor.getValue();
                let textarea = document.getElementById("codeEditor");
                textarea.value = code;
            });
        });





        document.addEventListener("DOMContentLoaded", function () {
            const githubBtn = document.getElementById("githubBtn");
            const githubModal = document.getElementById("githubModal");
            const analyzeGithubBtn = document.getElementById("analyzeGithubBtn");
            const closeGithubBtn = document.getElementById("closeGithubBtn");
            const githubRepoUrl = document.getElementById("githubRepoUrl");
            const codeEditor = document.getElementById("codeEditor");

            // Open modal
            githubBtn.addEventListener("click", function (event) {
                event.preventDefault();
                githubModal.style.display = "block";
            });

            // Close modal
            closeGithubBtn.addEventListener("click", function (event) {
                event.preventDefault();
                githubModal.style.display = "none";
            });

            // Handle GitHub analysis
            analyzeGithubBtn.addEventListener("click", function (event) {
                event.preventDefault();
                const repoUrl = githubRepoUrl.value.trim();

                if (!repoUrl) {
                    alert("Please enter a GitHub repository URL.");
                    return;
                }

                fetch("{% url 'analyze_code' %}", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "X-CSRFToken": "{{ csrf_token }}" // Ensure CSRF token is included
                    },
                    body: JSON.stringify({ github_url: repoUrl })
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.error) {
                            alert("Error fetching GitHub files: " + data.error);
                        } else {
                            let formattedCode = "";

                            data.files.forEach(file => {
                                formattedCode += `# File: ${file.name}\n${file.code}\n\n`;
                            });

                            if (window.editor) {
                                window.editor.setValue(formattedCode);
                            }
                            codeEditor.value = formattedCode;
                        }
                    })
                    .catch(error => {
                        console.error("Error:", error);
                        alert("Failed to fetch GitHub files.");
                    });

                githubModal.style.display = "none";
            });
        });





        document.addEventListener("DOMContentLoaded", function () {
            // Toggle severity details
            document.querySelectorAll(".severity-toggle").forEach(item => {
                item.addEventListener("click", function () {
                    const severity = this.getAttribute("data-severity").toLowerCase();
                    const details = document.getElementById(severity + "-details");

                    if (details.style.display === "none") {
                        details.style.display = "block";
                    } else {
                        details.style.display = "none";
                    }
                });
            });


            new Chart(document.getElementById('severityChart'), {
                type: 'pie',
                data: {
                    labels: Object.keys({{ summary.severity|safe }}),
                    datasets: [{
                        label: 'Severity Levels',
                        data: Object.values({{ summary.severity|safe }}),
                        backgroundColor: ['#FF6384', '#FFCE56', '#4BC0C0'],
                        borderColor: ['#FF6384', '#FFCE56', '#4BC0C0'],
                        borderWidth: 1
                    }]
                },
            });
        });

        document.addEventListener("DOMContentLoaded", function () {
            document.querySelectorAll(".category-toggle").forEach(item => {
                item.addEventListener("click", function () {
                    const category = this.getAttribute("data-category");
                    const details = document.getElementById(category.replace(/\s+/g, '-').toLowerCase() + "-details");

                    if (details) {
                        details.style.display = details.style.display === "none" ? "block" : "none";
                    }
                });
            });

            // Define more colors for categories
            const colorPalette = [
                'rgba(75, 192, 192, 0.2)',   // Teal
                'rgba(153, 102, 255, 0.2)',  // Purple
                'rgba(255, 159, 64, 0.2)',   // Orange
                'rgba(255, 99, 132, 0.2)',   // Red
                'rgba(54, 162, 235, 0.2)',   // Blue
                'rgba(255, 205, 86, 0.2)',   // Yellow
                'rgba(46, 204, 113, 0.2)',   // Green
                'rgba(231, 76, 60, 0.2)',    // Dark Red
                'rgba(241, 196, 15, 0.2)',   // Bright Yellow
                'rgba(155, 89, 182, 0.2)',   // Deep Purple
                'rgba(52, 152, 219, 0.2)',   // Sky Blue
                'rgba(39, 174, 96, 0.2)',    // Leaf Green
                'rgba(243, 156, 18, 0.2)'    // Orange-Yellow
            ];

            const borderColorPalette = colorPalette.map(color => color.replace("0.2", "1")); // Darker border colors

            // Generate category chart
            const categoryLabels = Object.keys({{ summary.categories|safe }});
            const categoryDataValues = Object.values({{ summary.categories|safe }});

            const categoryChart = new Chart(document.getElementById('categoryChart'), {
                type: 'pie',
                data: {
                    labels: categoryLabels,
                    datasets: [{
                        label: 'Categories',
                        data: categoryDataValues,
                        backgroundColor: categoryLabels.map((_, index) => colorPalette[index % colorPalette.length]), // Cycle colors
                        borderColor: categoryLabels.map((_, index) => borderColorPalette[index % borderColorPalette.length]), // Cycle border colors
                        borderWidth: 1
                    }]
                }
            });
        });



        // Severity Level Distribution Chart
        const severityData = {
            labels: Object.keys({{ summary.severity|safe }}),
            datasets: [{
                label: 'Severity Levels',
                data: Object.values({{ summary.severity|safe }}),
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)', // Critical - Red
                    'rgba(255, 206, 86, 0.2)', // Medium - Yellow
                    'rgba(75, 192, 192, 0.2)', // Low - Green
                ],
                borderColor: [
                    'rgba(255, 99, 132, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 192, 192, 1)',
                ],
                borderWidth: 1
            }]
        };

        new Chart(document.getElementById('severityChart'), {
            type: 'pie',
            data: severityData,
        });

        // Handle file upload and display content in the editor
        document.getElementById('fileInput').addEventListener('change', function (event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    codeMirrorEditor.setValue(e.target.result);
                };
                reader.readAsText(file);
            }
        });


    </script>



    <style>
        .summary-panel, .chart-container {
            background-color: var(--container-bg-color);
        }

    .severity-toggle {
        cursor: pointer;
    }

    .severity-container {
        max-height: 350px; /* Set a fixed height */
        overflow-y: auto; /* Enable vertical scrollbar */
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        background-color: #f9f9f9;
    }


    .severity-details {
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        margin-bottom: 10px;
        display: none;
        background-color: #f9f9f9;
    }

        .margin-left {
            margin-left: 635px;
            margin-top: 20px;
        }

        .recommendation-container {
            max-height: 600px;
            overflow-y: auto;
            padding: 10px;
            border: 1px solid #ddd;
            background-color: #f9f9f9;
            border-radius: 4px;
        }
        .code-block {
            background-color: #f0f8ff; /* Light blue background */
            border: 1px solid #cce7ff; /* Light blue border */
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
        }

        .suggestion-block {
            background-color: #e6ffe6; /* Light green background */
            border: 1px solid #b3ffb3; /* Light green border */
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        .category-toggle {
            cursor: pointer;
            font-weight: bold;
        }
        .category-container{
            max-height: 350px; /* Set a fixed height */
            overflow-y: auto; /* Enable vertical scrollbar */
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #f9f9f9;
        }


        .category-details {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-bottom: 10px;
            display: none;
            background-color: #f9f9f9;
        }
    /* Custom GitHub Button Styling */
    .btn-github {
        background-color: #0d74e7;  /* GitHub dark theme */
        color: white;
        border-radius: 8px;
        font-weight: 500;
        padding: 12px 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        border: none;
    }

    .btn-github i {
        margin-right: 8px;
        font-size: 18px;
    }

    .btn-github:hover {
        background-color: white; /* Darker shade on hover */
        color: #0d74e7;;
        transform: translateY(-2px);
    }

    .btn-github:active {
        transform: scale(0.98);
    }


    /* GitHub Import Modal */
    /* GitHub Import Modal */
    .github-modal {
        display: none; /* Initially hidden */
        position: fixed;
        z-index: 1050; /* Higher than normal elements */
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        width: 420px;
        background: #2c3e50; /* Modern dark blue */
        padding: 25px;
        border-radius: 12px; /* Softer edges */
        box-shadow: 0px 10px 30px rgba(0, 0, 0, 0.3);
        text-align: center;
        color: white; /* White text for contrast */
    }

    /* Modal Background Overlay */
    .github-modal::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6); /* Darker overlay for focus */
        z-index: -1;
    }

    /* Modal Content */
    .github-modal-content {
        padding: 20px;
    }

    /* Modal Header */
    .github-modal h4 {
        font-size: 22px;
        font-weight: bold;
        margin-bottom: 10px;
        color: #f1c40f; /* Yellow-Gold heading */
    }

    /* Input Field */
    .github-modal input {
        width: 100%;
        padding: 10px;
        border-radius: 8px;
        border: none;
        margin-top: 10px;
        background: #ecf0f1; /* Light gray background */
        color: #333;
        font-size: 16px;
    }

    /* Buttons inside the modal */
    .github-modal-content .btn {
        margin: 5px;
        padding: 10px 16px;
        font-size: 14px;
        border-radius: 8px;
        transition: all 0.2s ease-in-out;
    }

    /* Analyze Button */
    #analyzeGithubBtn {
        background: #27ae60; /* Green */
        color: white;
        border: none;
    }

    #analyzeGithubBtn:hover {
        background: #219150;
    }

    /* Close Button */
    #closeGithubBtn {
        background: #e74c3c; /* Red */
        color: white;
        border: none;
    }

    #closeGithubBtn:hover {
        background: #c0392b;
    }


{% endblock %}







{#{% extends 'base.html' %}#}
{##}
{#{% block content %}#}
{#    <h1 class="text-center mb-4">AI Code Analyzer</h1>#}
{##}
{#    <nav class="mb-4">#}
{#        <ul class="nav justify-content-center">#}
{#            <li class="nav-item">#}
{#                <a class="nav-link btn btn-outline-primary" href="{% url 'java_code_analysis' %}">Java Code Analyzer</a>#}
{#            </li>#}
{#            <li class="nav-item">#}
{#                <a class="nav-link btn btn-outline-primary" href="{% url 'python_code_analysis' %}">Python Code Analyzer</a>#}
{#            </li>#}
{#            <li class="nav-item">#}
{#                <a class="nav-link btn btn-outline-primary" href="{% url 'js_code_analyser' %}">JavaScript Analyzer</a>#}
{#            </li>#}
{#        </ul>#}
{#    </nav>#}
{##}
{#    <div class="container">#}
{#        <form method="POST" enctype="multipart/form-data">#}
{#            {% csrf_token %}#}
{#            <div class="mb-3">#}
{#                <label for="fileInput" class="form-label">Upload File(s):</label>#}
{#                <input type="file" name="files" id="fileInput" class="form-control mb-3" multiple>#}
{#            </div>#}
{#            <div class="mb-3">#}
{#                <label for="codeEditor" class="form-label">Paste Code Below:</label>#}
{#                <textarea id="codeEditor" name="code" class="form-control" rows="10">{{ code }}</textarea>#}
{#            </div>#}
{#            <div class="text-center">#}
{#                <button type="submit" class="btn btn-primary">Analyze Code</button>#}
{#            </div>#}
{#        </form>#}
{##}
{#        <div id="analysis-results" class="mt-4">#}
{#            {% if suggestions %}#}
{#                <h2 class="text-center mb-4">Analysis Results:</h2>#}
{#                <div class="recommendation-container scrollable-container">#}
{#                    {% for suggestion in suggestions %}#}
{#                        <div class="code-block">#}
{#                            <strong>Code With Issue:</strong>#}
{#                            <pre>{{ suggestion.code }}</pre>#}
{#                        </div>#}
{#                        <div class="suggestion-block">#}
{#                            <strong>Suggestion:</strong>#}
{#                            <pre>{{ suggestion.suggestion }}</pre>#}
{#                        </div>#}
{#                    {% endfor %}#}
{#                </div>#}
{#            {% else %}#}
{#                <p class="text-center">No recommendations available. Paste or upload code to analyze.</p>#}
{#            {% endif %}#}
{#        </div>#}
{##}
{#        <!-- Summary Report Section -->#}
        {#        <div class="container mt-4">#}
        {#            <div class="row">#}
        {#                <div class="col-md-6">#}
        {#                    <div class="summary-panel p-3 shadow-sm rounded">#}
        {#                        <h3 class="text-center">Summary Report</h3><br>#}
        {#                        <p><strong>Total Code Segments Analyzed:</strong> {{ summary.total_snippets }}</p>#}
        {#                        <p><strong>Total Suggestions:</strong> {{ summary.total_suggestions }}</p>#}
        {#                        <p><strong>Total Code Lines Processed:</strong> {{ summary.total_lines }}</p>#}
        {#                        <h4>Categories</h4>#}
        {#                        <ul class="list-group">#}
        {#                            {% for category, count in summary.categories.items %}#}
        {#                                <li class="list-group-item d-flex justify-content-between align-items-center">#}
        {#                                    {{ category }}#}
        {#                                    <span class="badge bg-primary rounded-pill">{{ count }}</span>#}
        {#                                </li>#}
        {#                            {% endfor %}#}
        {#                        </ul>#}
        {#                    <br>#}
        {#                        <h4>Severity Levels</h4>#}
        {#                        <ul class="list-group">#}
        {#                            {% for level, count in summary.severity.items %}#}
        {#                                <li class="list-group-item d-flex justify-content-between align-items-center">#}
        {#                                    {{ level }}#}
        {#                                    <span class="badge bg-warning rounded-pill">{{ count }}</span>#}
        {#                                </li>#}
        {#                            {% endfor %}#}
        {#                        </ul>#}
        {#                    </div>#}
        {#                </div>#}
        {#                <!-- Issue Category Distribution -->#}
        {#                <div class="col-md-6">#}
        {#                    <div class="chart-container p-3 shadow-sm rounded">#}
        {#                        <h4 class="text-center">Code Analysis Issue Distribution</h4>#}
        {#                        <canvas id="categoryChart" width="400" height="400"></canvas>#}
        {#                    </div>#}
        {#                </div>#}
        {#                <!-- Severity Level Distribution -->#}
        {#                <div class="col-md-6 margin-left">#}
        {#                    <div class="chart-container p-3 shadow-sm rounded">#}
        {#                        <h4 class="text-center">Severity Level Distribution</h4>#}
        {#                        <canvas id="severityChart" width="400" height="400" ></canvas>#}
        {#                    </div>#}
        {#                </div>#}
        {#            </div>#}
        {#        </div>#}
{##}
{#        <div class="container mt-4">#}
{#            <div class="row">#}
{#                <!-- Summary Panel -->#}
{#                <div class="col-md-6">#}
{#                    <div class="summary-panel p-3 shadow-sm rounded">#}
{#                        <h3 class="text-center">Code Analysis Summary Report</h3><br>#}
{#                        <p><strong>Total Code Segments Analyzed:</strong> {{ summary.total_snippets }}</p>#}
{#                        <p><strong>Total Suggestions:</strong> {{ summary.total_suggestions }}</p>#}
{#                        <p><strong>Total Code Lines Processed:</strong> {{ summary.total_lines }}</p>#}
{##}
{#                        <h4>Categories</h4>#}
{#                        <ul class="list-group">#}
{#                            {% for category, count in summary.categories.items %}#}
{#                                <li class="list-group-item d-flex justify-content-between align-items-center">#}
{#                                    {{ category }}#}
{#                                    <span class="badge bg-primary rounded-pill">{{ count }}</span>#}
{#                                </li>#}
{#                            {% endfor %}#}
{#                        </ul>#}
{#                        <br>#}
{#                        <h4>Severity Levels</h4>#}
{#                        <ul class="list-group">#}
{#                            {% for level, count in summary.severity.items %}#}
{#                                <li class="list-group-item d-flex justify-content-between align-items-center">#}
{#                                    {{ level }}#}
{#                                    <span class="badge bg-warning rounded-pill">{{ count }}</span>#}
{#                                </li>#}
{#                            {% endfor %}#}
{#                        </ul>#}
{#                    </div>#}
{#                </div>#}
{##}
{#                <!-- Charts Panel -->#}
{#                <div class="col-md-6">#}
{#                    <div class="chart-container p-3 shadow-sm rounded">#}
{#                        <h4 class="text-center">Code Analysis Issue Distribution</h4>#}
{#                        <canvas id="categoryChart" width="400" height="400"></canvas>#}
{#                    </div>#}
{##}
{#                    <div class="chart-container p-3 shadow-sm rounded mt-4">#}
{#                        <h4 class="text-center">Severity Level Distribution</h4>#}
{#                        <canvas id="severityChart" width="400" height="400"></canvas>#}
{#                    </div>#}
{#                </div>#}
{#            </div>#}
{#        </div>#}
{#        <!-- Analysis Results Section -->#}
{##}
{#    </div>#}
{##}
{#    <!-- Include CodeMirror -->#}
{#    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.js"></script>#}
{#    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/javascript/javascript.min.js"></script>#}
{##}
{#    <!-- Chart.js for Graph -->#}
{#    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>#}
{#    <script>#}
        {#const categoryData = {#}
        {#    labels: Object.keys({{ summary.categories|safe }}),#}
        {#    datasets: [{#}
        {#        label: 'Categories',#}
        {#        data: Object.values({{ summary.categories|safe }}),#}
        {#        backgroundColor: [#}
        {#            'rgba(75, 192, 192, 0.2)',#}
        {#            'rgba(153, 102, 255, 0.2)',#}
        {#            'rgba(255, 159, 64, 0.2)',#}
        {#        ],#}
        {#        borderColor: [#}
        {#            'rgba(75, 192, 192, 1)',#}
        {#            'rgba(153, 102, 255, 1)',#}
        {#            'rgba(255, 159, 64, 1)',#}
        {#        ],#}
        {#        borderWidth: 1#}
        {#    }]#}
        {#};#}
            {##}
            {#new Chart(document.getElementById('categoryChart'), {#}
            {#    type: 'pie',#}
            {#    data: categoryData,#}
            {#});#}
                {##}
                {##}
                {#// Severity Level Distribution Chart#}
                {#const severityData = {#}
                {#    labels: Object.keys({{ summary.severity|safe }}),#}
                {#    datasets: [{#}
                {#        label: 'Severity Levels',#}
                {#        data: Object.values({{ summary.severity|safe }}),#}
                {#        backgroundColor: [#}
                {#            'rgba(255, 99, 132, 0.2)', // Critical - Red#}
                {#            'rgba(255, 206, 86, 0.2)', // Medium - Yellow#}
                {#            'rgba(75, 192, 192, 0.2)', // Low - Green#}
                {#        ],#}
                {#        borderColor: [#}
                {#            'rgba(255, 99, 132, 1)',#}
                {#            'rgba(255, 206, 86, 1)',#}
                {#            'rgba(75, 192, 192, 1)',#}
                {#        ],#}
                {#        borderWidth: 1#}
                {#    }]#}
                {#};#}
                    {##}
                    {#new Chart(document.getElementById('severityChart'), {#}
                    {#    type: 'pie',#}
                    {#    data: severityData,#}
                    {#});#}
                        {#// Initialize CodeMirror#}
                        {#const codeMirrorEditor = CodeMirror.fromTextArea(document.getElementById('codeEditor'), {#}
                        {#    lineNumbers: true,#}
                        {#    mode: "javascript",#}
                        {#    theme: "default"#}
                        {#});#}
                            {##}
                            {#// Handle file upload and display content in the editor#}
                            {#document.getElementById('fileInput').addEventListener('change', function (event) {#}
                            {#    const file = event.target.files[0];#}
                            {#    if (file) {#}
                            {#        const reader = new FileReader();#}
                            {#        reader.onload = function (e) {#}
                            {#            codeMirrorEditor.setValue(e.target.result);#}
                            {#        };#}
                            {#        reader.readAsText(file);#}
                            {#    }#}
                            {#});#}
{#                                document.addEventListener("DOMContentLoaded", function () {#}
{#                                    // Initialize CodeMirror#}
{#                                    const textArea = document.getElementById('codeEditor');#}
{#                                    if (textArea) {#}
{#                                        const codeMirrorEditor = CodeMirror.fromTextArea(textArea, {#}
{#                                            lineNumbers: true,#}
{#                                            mode: "javascript",#}
{#                                            theme: "material",#}
{#                                            lineWrapping: true,#}
{#                                        });#}
{#                                        codeMirrorEditor.setSize("100%", "250px");#}
{#                                    }#}
{##}
{#                                    // Handle file upload and display content in the editor#}
{#                                    document.getElementById('fileInput').addEventListener('change', function (event) {#}
{#                                        const file = event.target.files[0];#}
{#                                        if (file) {#}
{#                                            const reader = new FileReader();#}
{#                                            reader.onload = function (e) {#}
{#                                                if (typeof codeMirrorEditor !== "undefined") {#}
{#                                                    codeMirrorEditor.setValue(e.target.result);#}
{#                                                } else {#}
{#                                                    document.getElementById('codeEditor').value = e.target.result;#}
{#                                                }#}
{#                                            };#}
{#                                            reader.readAsText(file);#}
{#                                        }#}
{#                                    });#}
{##}
{#                                    // Issue Category Distribution Chart#}
{#                                    new Chart(document.getElementById('categoryChart'), {#}
{#                                        type: 'pie',#}
{#                                        data: {#}
{#                                            labels: Object.keys({{ summary.categories|safe }}),#}
{#                                            datasets: [{#}
{#                                                label: 'Categories',#}
{#                                                data: Object.values({{ summary.categories|safe }}),#}
{#                                                backgroundColor: ['#4BC0C0', '#9966FF', '#FF9F40'],#}
{#                                                borderColor: ['#4BC0C0', '#9966FF', '#FF9F40'],#}
{#                                                borderWidth: 1#}
{#                                            }]#}
{#                                        },#}
{#                                    });#}
{##}
{#                                    // Severity Level Distribution Chart#}
{#                                    new Chart(document.getElementById('severityChart'), {#}
{#                                        type: 'pie',#}
{#                                        data: {#}
{#                                            labels: Object.keys({{ summary.severity|safe }}),#}
{#                                            datasets: [{#}
{#                                                label: 'Severity Levels',#}
{#                                                data: Object.values({{ summary.severity|safe }}),#}
{#                                                backgroundColor: ['#FF6384', '#FFCE56', '#4BC0C0'],#}
{#                                                borderColor: ['#FF6384', '#FFCE56', '#4BC0C0'],#}
{#                                                borderWidth: 1#}
{#                                            }]#}
{#                                        },#}
{#                                    });#}
{#                                });#}
{#    </script>#}
{##}
{#    <style>#}
{#        .summary-panel, .chart-container {#}
{#            background-color: var(--container-bg-color);#}
{#        }#}
{##}
{#        .margin-left {#}
{#            margin-left: 635px;#}
{#            margin-top: 20px;#}
{#        }#}
{##}
{#        .recommendation-container {#}
{#            max-height: 400px;#}
{#            overflow-y: auto;#}
{#            padding: 10px;#}
{#            border: 1px solid #ddd;#}
{#            background-color: #f9f9f9;#}
{#            border-radius: 4px;#}
{#        }#}
{#        .code-block {#}
{#            background-color: #f0f8ff; /* Light blue background */#}
{#            border: 1px solid #cce7ff; /* Light blue border */#}
{#            padding: 10px;#}
{#            margin-bottom: 10px;#}
{#            border-radius: 4px;#}
{#        }#}
{##}
{#        .suggestion-block {#}
{#            background-color: #e6ffe6; /* Light green background */#}
{#            border: 1px solid #b3ffb3; /* Light green border */#}
{#            padding: 10px;#}
{#            margin-bottom: 20px;#}
{#            border-radius: 4px;#}
{#        }#}
{##}
{#        textarea#codeEditor, .CodeMirror {#}
{#            background-color: #1e1e1e !important;#}
{#            color: white !important;#}
{#            border: 1px solid #4fa3ff !important;#}
{#            width: 100% !important;#}
{#            min-height: 250px !important;#}
{#        }#}
{##}
{#        /* Fix Summary Report Text */#}
{#        .form-control, .list-group-item, .nav-link, .btn {#}
{#            color: white !important;#}
{#        }#}
{##}
{#        .list-group-item {#}
{#            background-color: #1e1e1e !important;#}
{#            border-color: #4fa3ff !important;#}
{#        }#}
{##}
{#        /* Ensure Charts Align */#}
{#        .chart-container {#}
{#            background-color: #1e1e1e !important;#}
{#            padding: 15px;#}
{#            border-radius: 8px;#}
{#            box-shadow: 0px 4px 10px rgba(255, 255, 255, 0.1);#}
{#        }#}
{#    </style>#}
{#{% endblock %}#}


